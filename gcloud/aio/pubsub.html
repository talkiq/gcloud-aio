<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.0"/>
    <title>gcloud.aio.pubsub API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../aio.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;gcloud.aio</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

        <h2>Contents</h2>
        <ul>
  <li><a href="#installation">Installation</a></li>
  <li><a href="#usage">Usage</a></li>
  <li><a href="#publisher">Publisher</a></li>
  <li><a href="#emulators">Emulators</a></li>
  <li><a href="#customization">Customization</a></li>
</ul>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#PublisherClient">PublisherClient</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PublisherClient.__init__">PublisherClient</a>
                        </li>
                        <li>
                                <a class="function" href="#PublisherClient.project_path">project_path</a>
                        </li>
                        <li>
                                <a class="function" href="#PublisherClient.subscription_path">subscription_path</a>
                        </li>
                        <li>
                                <a class="function" href="#PublisherClient.topic_path">topic_path</a>
                        </li>
                        <li>
                                <a class="function" href="#PublisherClient.list_topics">list_topics</a>
                        </li>
                        <li>
                                <a class="function" href="#PublisherClient.create_topic">create_topic</a>
                        </li>
                        <li>
                                <a class="function" href="#PublisherClient.delete_topic">delete_topic</a>
                        </li>
                        <li>
                                <a class="function" href="#PublisherClient.publish">publish</a>
                        </li>
                        <li>
                                <a class="function" href="#PublisherClient.close">close</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PubsubMessage">PubsubMessage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PubsubMessage.__init__">PubsubMessage</a>
                        </li>
                        <li>
                                <a class="function" href="#PubsubMessage.to_repr">to_repr</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SubscriberClient">SubscriberClient</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SubscriberClient.__init__">SubscriberClient</a>
                        </li>
                        <li>
                                <a class="function" href="#SubscriberClient.create_subscription">create_subscription</a>
                        </li>
                        <li>
                                <a class="function" href="#SubscriberClient.delete_subscription">delete_subscription</a>
                        </li>
                        <li>
                                <a class="function" href="#SubscriberClient.pull">pull</a>
                        </li>
                        <li>
                                <a class="function" href="#SubscriberClient.acknowledge">acknowledge</a>
                        </li>
                        <li>
                                <a class="function" href="#SubscriberClient.modify_ack_deadline">modify_ack_deadline</a>
                        </li>
                        <li>
                                <a class="function" href="#SubscriberClient.get_subscription">get_subscription</a>
                        </li>
                        <li>
                                <a class="function" href="#SubscriberClient.list_subscriptions">list_subscriptions</a>
                        </li>
                        <li>
                                <a class="function" href="#SubscriberClient.close">close</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SubscriberMessage">SubscriberMessage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SubscriberMessage.__init__">SubscriberMessage</a>
                        </li>
                        <li>
                                <a class="function" href="#SubscriberMessage.from_repr">from_repr</a>
                        </li>
                        <li>
                                <a class="function" href="#SubscriberMessage.to_repr">to_repr</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#__version__">__version__</a>
            </li>
            <li>
                    <a class="function" href="#subscribe">subscribe</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../gcloud.html">gcloud</a><wbr>.<a href="./../aio.html">aio</a><wbr>.pubsub    </h1>

                        <div class="docstring"><p>This library implements various methods for working with the Google Pubsub
APIs.</p>

<h2 id="installation">Installation</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>gcloud-aio-pubsub
</code></pre>
</div>

<h2 id="usage">Usage</h2>

<h3 id="subscriber">Subscriber</h3>

<p><code>gcloud-aio-pubsub</code> provides <code><a href="#SubscriberClient">SubscriberClient</a></code> as an interface to call
pubsub's HTTP API:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="">gcloud.aio.pubsub</a></span> <span class="kn">import</span> <span class="n">SubscriberClient</span>
<span class="kn">from</span> <span class="nn"><a href="">gcloud.aio.pubsub</a></span> <span class="kn">import</span> <span class="n">SubscriberMessage</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">SubscriberClient</span><span class="p">()</span>
<span class="c1"># create subscription</span>
<span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span>
    <span class="s1">&#39;projects/&lt;project_name&gt;/subscriptions/&lt;subscription_name&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;projects/&lt;project_name&gt;/topics/&lt;topic_name&gt;&#39;</span><span class="p">)</span>

<span class="c1"># pull messages</span>
<span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SubscriberMessage</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span>
    <span class="s1">&#39;projects/&lt;project_name&gt;/subscriptions/&lt;subscription_name&gt;&#39;</span><span class="p">,</span>
    <span class="n">max_messages</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre>
</div>

<p>There's also <code><a href="#subscribe">gcloud.aio.pubsub.subscribe</a></code> helper function you can use to setup
a pubsub processing pipeline. It is built with <code>asyncio</code> and thus only
available in the <code>gcloud-aio-pubsub</code> package. The usage is fairly simple:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="">gcloud.aio.pubsub</a></span> <span class="kn">import</span> <span class="n">SubscriberClient</span>
<span class="kn">from</span> <span class="nn"><a href="">gcloud.aio.pubsub</a></span> <span class="kn">import</span> <span class="n">subscribe</span>

<span class="n">subscriber_client</span> <span class="o">=</span> <span class="n">SubscriberClient</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">await</span> <span class="n">subscribe</span><span class="p">(</span>
    <span class="s1">&#39;projects/&lt;my_project&gt;/subscriptions/&lt;my_subscription&gt;&#39;</span><span class="p">,</span>
    <span class="n">handler</span><span class="p">,</span>
    <span class="n">subscriber_client</span><span class="p">,</span>
    <span class="n">num_producers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_messages_per_producer</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">ack_window</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">num_tasks_per_consumer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">enable_nack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">nack_window</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
</div>

<p>While defaults are somewhat sensible, it is highly recommended to performance
test your application and tweak function parameter to your specific needs.
Here's a few hints:</p>

<ul>
<li><code>handler</code>: An async function that will be called for each message. It should
accept an instance of <code><a href="#SubscriberMessage">SubscriberMessage</a></code> as its only argument and return
<code>None</code> if the message should be acked. An exception raised within the handler
will result in the message being left to expire, and thus it will be
redelivered according to your subscription's ack deadline.</li>
<li><code>num_producers</code>: Number of workers that will be making <code>pull</code> requests to
pubsub. Please note that a worker will only fetch new batch once the
<code>handler</code> was called for each message from the previous batch. This means
that running only a single worker will most likely make your application IO
bound. If you notice this being an issue don't hesitate to bump this
parameter.</li>
<li><code>max_messages_per_producer</code>: Number of pubsub messages a worker will try to
fetch in a single batch. This value is passed to <code>pull</code> <a href="https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.subscriptions/pull#request-body">endpoint</a>
as <code>maxMessages</code> parameter. A rule of thumb here is the faster your handler
is the bigger this value should be.</li>
<li><code>ack_window</code>: Ack requests are handled separately and are done in batches.
This parameters specifies how often ack requests will be made. Setting it to
<code>0.0</code> will effectively disable batching.</li>
<li><code>num_tasks_per_consumer</code>: How many <code>handle</code> calls a worker can make until it
blocks to wait for them to return. If you process messages independently from
each other you should be good with the default value of <code>1</code>. If you do
something fancy (e.g. aggregate messages before processing them), you'll want
a higher pool here. You can think of <code>num_producers * num_tasks_per_consumer</code>
as an upper limit of how many messages can possibly be within your
application state at any given moment.</li>
<li><code>enable_nack</code>: If enabled messages for which <code>callback</code> raised an exception
will be explicitly nacked using <code>modifyAckDeadline</code> endpoint so they can be
retried immediately.</li>
<li><code>nack_window</code>: Same as <code>ack_window</code> but for nack requests.</li>
</ul>

<p>Note that this method was built under the assumption that it is the main thread
of your application. It may work just fine otherwise, but be aware that the
usecase of running it in a background thread has not been extensively tested.</p>

<p>As it is generally assumed to run in the foreground, it relies on task
cancellation to shut itself down (ie. caused by process termination). To cancel
it from a thread, you can send an <code>asyncio.CancelledError</code> event via
<code>Task.cancel()</code>:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">subscribe_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n"><a href="#subscribe">gcloud.aio.pubsub.subscribe</a></span><span class="p">(</span><span class="o">...</span><span class="p">))</span>

<span class="c1"># snip</span>

<span class="n">subscribe_task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</code></pre>
</div>

<h3 id="prometheus-metrics">Prometheus Metrics</h3>

<p>If you like pull-based metrics like Prometheus you will be pleased to know that
the subscriber records Prometheus metrics in the form
<code>gcloud_aio_pubsub_&lt;metric&gt;</code>, which will have no effect if you don't use
Prometheus to scrape app metrics:</p>

<ul>
<li><code>subscriber_batch_size</code> - [histogram] how many messages were pulled from the
subscription in a single batch</li>
<li><code>subscriber_consume</code> (labels: <code>outcome = {'succeeded', 'cancelled', 'failed',
'failfast'}</code>) - [counter] a consume operation has completed with a given
outcome</li>
<li><code>subscriber_consume_latency_seconds</code> (labels: <code>phase = {'receive',
'queueing', 'runtime'}</code>) - [histogram] how many seconds taken to receive a
message, while waiting for processing, or to complete the callback</li>
<li><code>subscriber_batch_status</code> (labels: <code>component = {'acker', 'nacker'}, outcome
= {'succeeded', 'failed'}</code>) - [counter] a batch has succeeded or failed to be
acked or nacked</li>
<li><code>subscriber_messages_processed</code> (labels: <code>component = {'acker', 'nacker'}</code>) -
[counter] the number of messages that were processed, either by being acked
or nacked</li>
<li><code>subscriber_messages_received</code> - [counter] the number of messages pulled from
pubsub</li>
</ul>

<h3 id="metrics-agent-deprecated">Metrics Agent (Deprecated)</h3>

<p><code><a href="#subscribe">subscribe</a></code> has also an optional <code>metrics_client</code> argument which will be
removed in a future release. You can provide any metrics agent that implements
the same interface as <code>MetricsAgent</code> (Datadog client will do ;) ) and get the
following metrics:</p>

<ul>
<li><code>pubsub.producer.batch</code> - [histogram] actual size of a batch retrieved from
pubsub.</li>
<li><code>pubsub.consumer.failfast</code> - [increment] a message was dropped due to its
lease being expired.</li>
<li><code>pubsub.consumer.latency.receive</code> - [histogram] how many seconds it took for
a message to reach handler after it was published.</li>
<li><code>pubsub.consumer.succeeded</code> - [increment] <code>handler</code> call was successfull.</li>
<li><code>pubsub.consumer.failed</code> - [increment] <code>handler</code> call raised an exception.</li>
<li><code>pubsub.consumer.latency.runtime</code> - [histogram] <code>handler</code> execution time in
seconds.</li>
<li><code>pubsub.acker.batch.failed</code> - [increment] ack request failed.</li>
<li><code>pubsub.acker.batch</code> - [histogram] actual number of messages that was acked
in a single request.</li>
</ul>

<h2 id="publisher">Publisher</h2>

<p>The <code><a href="#PublisherClient">PublisherClient</a></code> is a dead-simple alternative to the official Google Cloud
Pub/Sub publisher client. The main design goal was to eliminate all the
additional gRPC overhead implemented by the upstream client.</p>

<p>If migrating between this library and the official one, the main difference is
this: the <code>gcloud-{aio,rest}-pubsub</code> publisher's <code>.publish()</code> method
<em>immediately</em> publishes the messages you've provided, rather than maintaining
our own publishing queue, implementing batching and flow control, etc. If
you're looking for a full-featured publishing library with all the bells and
whistles built in, you may be interested in the upstream provider. If you're
looking to manage your own batching / timeouts / retry / threads / etc, this
library should be a bit easier to work with.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="">gcloud.aio.pubsub</a></span> <span class="kn">import</span> <span class="n">PubsubMessage</span>
<span class="kn">from</span> <span class="nn"><a href="">gcloud.aio.pubsub</a></span> <span class="kn">import</span> <span class="n">PublisherClient</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">PublisherClient</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>

    <span class="n">topic</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">topic_path</span><span class="p">(</span><span class="s1">&#39;my-gcp-project&#39;</span><span class="p">,</span> <span class="s1">&#39;my-topic-name&#39;</span><span class="p">)</span>

    <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">PubsubMessage</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;payload&#39;</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">),</span>
        <span class="n">PubsubMessage</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;other payload&#39;</span><span class="p">,</span> <span class="n">other_attribute</span><span class="o">=</span><span class="s1">&#39;whatever&#39;</span><span class="p">,</span>
                      <span class="n">more_attributes</span><span class="o">=</span><span class="s1">&#39;something else&#39;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">messages</span><span class="p">)</span>
    <span class="c1"># response == {&#39;messageIds&#39;: [&#39;1&#39;, &#39;2&#39;]}</span>
</code></pre>
</div>

<h2 id="emulators">Emulators</h2>

<p>For testing purposes, you may want to use <code>gcloud-aio-pubsub</code> along with a
local Pubsub emulator. Setting the <code>$PUBSUB_EMULATOR_HOST</code> environment variable
to the local address of your emulator should be enough to do the trick.</p>

<p>For example, using the official Google Pubsub emulator:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>gcloud<span class="w"> </span>beta<span class="w"> </span>emulators<span class="w"> </span>pubsub<span class="w"> </span>start<span class="w"> </span>--host-port<span class="o">=</span><span class="m">0</span>.0.0.0:8681
<span class="nb">export</span><span class="w"> </span><span class="nv">PUBSUB_EMULATOR_HOST</span><span class="o">=</span><span class="s1">&#39;0.0.0.0:8681&#39;</span>
</code></pre>
</div>

<p>Any <code>gcloud-aio-pubsub</code> Publisher requests made with that environment variable
set will query the emulator instead of the official GCS APIs.</p>

<p>For easier ergonomics, you may be interested in
<a href="https://github.com/TheKevJames/tools/tree/master/docker-gcloud-pubsub-emulator">thekevjames/gcloud-pubsub-emulator</a>.</p>

<h2 id="customization">Customization</h2>

<p>This library mostly tries to stay agnostic of potential use-cases; as such, we
do not implement any sort of retrying or other policies under the assumption
that we wouldn't get things right for every user's situation.</p>

<p>As such, we recommend configuring your own policies on an as-needed basis. The
<a href="https://pypi.org/project/backoff/">backoff</a> library can make this quite straightforward! For example,
you may find it useful to configure something like:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">class</span> <span class="nc">SubscriberClientWithBackoff</span><span class="p">(</span><span class="n">SubscriberClient</span><span class="p">):</span>
    <span class="nd">@backoff</span><span class="o">.</span><span class="n">on_exception</span><span class="p">(</span><span class="n">backoff</span><span class="o">.</span><span class="n">expo</span><span class="p">,</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientResponseError</span><span class="p">,</span>
                          <span class="n">max_tries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="n">backoff</span><span class="o">.</span><span class="n">full_jitter</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre>
</div>
</div>

                        <input id="mod-pubsub-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-pubsub-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">This library implements various methods for working with the Google Pubsub</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">APIs.</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">## Installation</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">```console</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">$ pip install --upgrade gcloud-aio-pubsub</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">```</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">## Usage</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">### Subscriber</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">`gcloud-aio-pubsub` provides `SubscriberClient` as an interface to call</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">pubsub&#39;s HTTP API:</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">```python</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">from gcloud.aio.pubsub import SubscriberClient</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">from gcloud.aio.pubsub import SubscriberMessage</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">client = SubscriberClient()</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd"># create subscription</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">await client.create_subscription(</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    &#39;projects/&lt;project_name&gt;/subscriptions/&lt;subscription_name&gt;&#39;,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    &#39;projects/&lt;project_name&gt;/topics/&lt;topic_name&gt;&#39;)</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd"># pull messages</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">messages: List[SubscriberMessage] = await client.pull(</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    &#39;projects/&lt;project_name&gt;/subscriptions/&lt;subscription_name&gt;&#39;,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    max_messages=10)</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">```</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">There&#39;s also `gcloud.aio.pubsub.subscribe` helper function you can use to setup</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">a pubsub processing pipeline. It is built with `asyncio` and thus only</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">available in the `gcloud-aio-pubsub` package. The usage is fairly simple:</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">```python</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">from gcloud.aio.pubsub import SubscriberClient</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">from gcloud.aio.pubsub import subscribe</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">subscriber_client = SubscriberClient()</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">async def handler(message):</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    return</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">await subscribe(</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    &#39;projects/&lt;my_project&gt;/subscriptions/&lt;my_subscription&gt;&#39;,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    handler,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    subscriber_client,</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    num_producers=1,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    max_messages_per_producer=100,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    ack_window=0.3,</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    num_tasks_per_consumer=1,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">    enable_nack=True,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    nack_window=0.3,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">)</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">```</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">While defaults are somewhat sensible, it is highly recommended to performance</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">test your application and tweak function parameter to your specific needs.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">Here&#39;s a few hints:</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">- `handler`: An async function that will be called for each message. It should</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">  accept an instance of `SubscriberMessage` as its only argument and return</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">  `None` if the message should be acked. An exception raised within the handler</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">  will result in the message being left to expire, and thus it will be</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">  redelivered according to your subscription&#39;s ack deadline.</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">- `num_producers`: Number of workers that will be making `pull` requests to</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">  pubsub. Please note that a worker will only fetch new batch once the</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">  `handler` was called for each message from the previous batch. This means</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">  that running only a single worker will most likely make your application IO</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">  bound. If you notice this being an issue don&#39;t hesitate to bump this</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">  parameter.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">- `max_messages_per_producer`: Number of pubsub messages a worker will try to</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">  fetch in a single batch. This value is passed to `pull` [endpoint][endpoint]</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">  as `maxMessages` parameter. A rule of thumb here is the faster your handler</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">  is the bigger this value should be.</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">- `ack_window`: Ack requests are handled separately and are done in batches.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">  This parameters specifies how often ack requests will be made. Setting it to</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">  `0.0` will effectively disable batching.</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">- `num_tasks_per_consumer`: How many `handle` calls a worker can make until it</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">  blocks to wait for them to return. If you process messages independently from</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">  each other you should be good with the default value of `1`. If you do</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">  something fancy (e.g. aggregate messages before processing them), you&#39;ll want</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">  a higher pool here. You can think of `num_producers * num_tasks_per_consumer`</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">  as an upper limit of how many messages can possibly be within your</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">  application state at any given moment.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">- `enable_nack`: If enabled messages for which `callback` raised an exception</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">  will be explicitly nacked using `modifyAckDeadline` endpoint so they can be</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">  retried immediately.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">- `nack_window`: Same as `ack_window` but for nack requests.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">Note that this method was built under the assumption that it is the main thread</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">of your application. It may work just fine otherwise, but be aware that the</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">usecase of running it in a background thread has not been extensively tested.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">As it is generally assumed to run in the foreground, it relies on task</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">cancellation to shut itself down (ie. caused by process termination). To cancel</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">it from a thread, you can send an `asyncio.CancelledError` event via</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">`Task.cancel()`:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">```python</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">subscribe_task = asyncio.create_task(gcloud.aio.pubsub.subscribe(...))</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd"># snip</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">subscribe_task.cancel()</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">```</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">### Prometheus Metrics</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">If you like pull-based metrics like Prometheus you will be pleased to know that</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">the subscriber records Prometheus metrics in the form</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">`gcloud_aio_pubsub_&lt;metric&gt;`, which will have no effect if you don&#39;t use</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">Prometheus to scrape app metrics:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">- `subscriber_batch_size` - [histogram] how many messages were pulled from the</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">  subscription in a single batch</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">- `subscriber_consume` (labels: `outcome = {&#39;succeeded&#39;, &#39;cancelled&#39;, &#39;failed&#39;,</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">  &#39;failfast&#39;}`) - [counter] a consume operation has completed with a given</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">  outcome</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">- `subscriber_consume_latency_seconds` (labels: `phase = {&#39;receive&#39;,</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">  &#39;queueing&#39;, &#39;runtime&#39;}`) - [histogram] how many seconds taken to receive a</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">  message, while waiting for processing, or to complete the callback</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">- `subscriber_batch_status` (labels: `component = {&#39;acker&#39;, &#39;nacker&#39;}, outcome</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">  = {&#39;succeeded&#39;, &#39;failed&#39;}`) - [counter] a batch has succeeded or failed to be</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">  acked or nacked</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">- `subscriber_messages_processed` (labels: `component = {&#39;acker&#39;, &#39;nacker&#39;}`) -</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">  [counter] the number of messages that were processed, either by being acked</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">  or nacked</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">- `subscriber_messages_received` - [counter] the number of messages pulled from</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">  pubsub</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">### Metrics Agent (Deprecated)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">`subscribe` has also an optional `metrics_client` argument which will be</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">removed in a future release. You can provide any metrics agent that implements</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">the same interface as `MetricsAgent` (Datadog client will do ;) ) and get the</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">following metrics:</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">- `pubsub.producer.batch` - [histogram] actual size of a batch retrieved from</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">  pubsub.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">- `pubsub.consumer.failfast` - [increment] a message was dropped due to its</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">  lease being expired.</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">- `pubsub.consumer.latency.receive` - [histogram] how many seconds it took for</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">  a message to reach handler after it was published.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">- `pubsub.consumer.succeeded` - [increment] `handler` call was successfull.</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">- `pubsub.consumer.failed` - [increment] `handler` call raised an exception.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">- `pubsub.consumer.latency.runtime` - [histogram] `handler` execution time in</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">  seconds.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">- `pubsub.acker.batch.failed` - [increment] ack request failed.</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">- `pubsub.acker.batch` - [histogram] actual number of messages that was acked</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">  in a single request.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">## Publisher</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">The `PublisherClient` is a dead-simple alternative to the official Google Cloud</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">Pub/Sub publisher client. The main design goal was to eliminate all the</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">additional gRPC overhead implemented by the upstream client.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">If migrating between this library and the official one, the main difference is</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">this: the `gcloud-{aio,rest}-pubsub` publisher&#39;s `.publish()` method</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">*immediately* publishes the messages you&#39;ve provided, rather than maintaining</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">our own publishing queue, implementing batching and flow control, etc. If</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">you&#39;re looking for a full-featured publishing library with all the bells and</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">whistles built in, you may be interested in the upstream provider. If you&#39;re</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">looking to manage your own batching / timeouts / retry / threads / etc, this</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">library should be a bit easier to work with.</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">```python</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">from gcloud.aio.pubsub import PubsubMessage</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">from gcloud.aio.pubsub import PublisherClient</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">async with aiohttp.ClientSession() as session:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">    client = PublisherClient(session=session)</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">    topic = client.topic_path(&#39;my-gcp-project&#39;, &#39;my-topic-name&#39;)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">    messages = [</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        PubsubMessage(b&#39;payload&#39;, attribute=&#39;value&#39;),</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">        PubsubMessage(b&#39;other payload&#39;, other_attribute=&#39;whatever&#39;,</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">                      more_attributes=&#39;something else&#39;),</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">    ]</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">    response = await client.publish(topic, messages)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">    # response == {&#39;messageIds&#39;: [&#39;1&#39;, &#39;2&#39;]}</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">```</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">## Emulators</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">For testing purposes, you may want to use `gcloud-aio-pubsub` along with a</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">local Pubsub emulator. Setting the `$PUBSUB_EMULATOR_HOST` environment variable</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">to the local address of your emulator should be enough to do the trick.</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">For example, using the official Google Pubsub emulator:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">```shell</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">gcloud beta emulators pubsub start --host-port=0.0.0.0:8681</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">export PUBSUB_EMULATOR_HOST=&#39;0.0.0.0:8681&#39;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">```</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">Any `gcloud-aio-pubsub` Publisher requests made with that environment variable</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">set will query the emulator instead of the official GCS APIs.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">For easier ergonomics, you may be interested in</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">[thekevjames/gcloud-pubsub-emulator][emulator-docker].</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">## Customization</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">This library mostly tries to stay agnostic of potential use-cases; as such, we</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">do not implement any sort of retrying or other policies under the assumption</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">that we wouldn&#39;t get things right for every user&#39;s situation.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">As such, we recommend configuring your own policies on an as-needed basis. The</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">[backoff][backoff] library can make this quite straightforward! For example,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">you may find it useful to configure something like:</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">```python</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">class SubscriberClientWithBackoff(SubscriberClient):</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">    @backoff.on_exception(backoff.expo, aiohttp.ClientResponseError,</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">                          max_tries=5, jitter=backoff.full_jitter)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">    async def pull(self, *args: Any, **kwargs: Any):</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">        return await super().pull(*args, **kwargs)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">```</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">[backoff]: https://pypi.org/project/backoff/</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">[emulator-docker]:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">https://github.com/TheKevJames/tools/tree/master/docker-gcloud-pubsub-emulator</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">[endpoint]:</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.subscriptions/pull#request-body</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">get_distribution</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="n">get_distribution</span><span class="p">(</span><span class="s1">&#39;gcloud-aio-pubsub&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">version</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="kn">from</span> <span class="nn">gcloud.aio.auth</span> <span class="kn">import</span> <span class="n">BUILD_GCLOUD_REST</span>  <span class="c1"># pylint: disable=no-name-in-module</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="kn">from</span> <span class="nn">gcloud.aio.pubsub.publisher_client</span> <span class="kn">import</span> <span class="n">PublisherClient</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="kn">from</span> <span class="nn">gcloud.aio.pubsub.subscriber_client</span> <span class="kn">import</span> <span class="n">SubscriberClient</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="kn">from</span> <span class="nn">gcloud.aio.pubsub.subscriber_message</span> <span class="kn">import</span> <span class="n">SubscriberMessage</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="kn">from</span> <span class="nn">gcloud.aio.pubsub.utils</span> <span class="kn">import</span> <span class="n">PubsubMessage</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>    <span class="s1">&#39;PublisherClient&#39;</span><span class="p">,</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>    <span class="s1">&#39;PubsubMessage&#39;</span><span class="p">,</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>    <span class="s1">&#39;SubscriberClient&#39;</span><span class="p">,</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>    <span class="s1">&#39;SubscriberMessage&#39;</span><span class="p">,</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="s1">&#39;__version__&#39;</span><span class="p">,</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="p">]</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="k">if</span> <span class="ow">not</span> <span class="n">BUILD_GCLOUD_REST</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="kn">from</span> <span class="nn">gcloud.aio.pubsub.subscriber</span> <span class="kn">import</span> <span class="n">subscribe</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>    <span class="n">__all__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;subscribe&#39;</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="PublisherClient">
                            <input id="PublisherClient-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PublisherClient</span>:

                <label class="view-source-button" for="PublisherClient-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PublisherClient"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PublisherClient-44"><a href="#PublisherClient-44"><span class="linenos"> 44</span></a><span class="k">class</span> <span class="nc">PublisherClient</span><span class="p">:</span>
</span><span id="PublisherClient-45"><a href="#PublisherClient-45"><span class="linenos"> 45</span></a>    <span class="n">_api_root</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="PublisherClient-46"><a href="#PublisherClient-46"><span class="linenos"> 46</span></a>    <span class="n">_api_is_dev</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="PublisherClient-47"><a href="#PublisherClient-47"><span class="linenos"> 47</span></a>
</span><span id="PublisherClient-48"><a href="#PublisherClient-48"><span class="linenos"> 48</span></a>    <span class="c1"># TODO: add project override</span>
</span><span id="PublisherClient-49"><a href="#PublisherClient-49"><span class="linenos"> 49</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PublisherClient-50"><a href="#PublisherClient-50"><span class="linenos"> 50</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">service_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IO</span><span class="p">[</span><span class="n">AnyStr</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient-51"><a href="#PublisherClient-51"><span class="linenos"> 51</span></a>            <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient-52"><a href="#PublisherClient-52"><span class="linenos"> 52</span></a>            <span class="n">api_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient-53"><a href="#PublisherClient-53"><span class="linenos"> 53</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PublisherClient-54"><a href="#PublisherClient-54"><span class="linenos"> 54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_api_is_dev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span> <span class="o">=</span> <span class="n">init_api_root</span><span class="p">(</span><span class="n">api_root</span><span class="p">)</span>
</span><span id="PublisherClient-55"><a href="#PublisherClient-55"><span class="linenos"> 55</span></a>
</span><span id="PublisherClient-56"><a href="#PublisherClient-56"><span class="linenos"> 56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">verify_ssl</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_is_dev</span><span class="p">)</span>
</span><span id="PublisherClient-57"><a href="#PublisherClient-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span> <span class="ow">or</span> <span class="n">Token</span><span class="p">(</span>
</span><span id="PublisherClient-58"><a href="#PublisherClient-58"><span class="linenos"> 58</span></a>            <span class="n">service_file</span><span class="o">=</span><span class="n">service_file</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="n">SCOPES</span><span class="p">,</span>
</span><span id="PublisherClient-59"><a href="#PublisherClient-59"><span class="linenos"> 59</span></a>            <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="PublisherClient-60"><a href="#PublisherClient-60"><span class="linenos"> 60</span></a>        <span class="p">)</span>
</span><span id="PublisherClient-61"><a href="#PublisherClient-61"><span class="linenos"> 61</span></a>
</span><span id="PublisherClient-62"><a href="#PublisherClient-62"><span class="linenos"> 62</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PublisherClient-63"><a href="#PublisherClient-63"><span class="linenos"> 63</span></a>    <span class="k">def</span> <span class="nf">project_path</span><span class="p">(</span><span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PublisherClient-64"><a href="#PublisherClient-64"><span class="linenos"> 64</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;projects/</span><span class="si">{</span><span class="n">project</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="PublisherClient-65"><a href="#PublisherClient-65"><span class="linenos"> 65</span></a>
</span><span id="PublisherClient-66"><a href="#PublisherClient-66"><span class="linenos"> 66</span></a>    <span class="nd">@classmethod</span>
</span><span id="PublisherClient-67"><a href="#PublisherClient-67"><span class="linenos"> 67</span></a>    <span class="k">def</span> <span class="nf">subscription_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PublisherClient-68"><a href="#PublisherClient-68"><span class="linenos"> 68</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">project_path</span><span class="p">(</span><span class="n">project</span><span class="p">)</span><span class="si">}</span><span class="s1">/subscriptions/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="PublisherClient-69"><a href="#PublisherClient-69"><span class="linenos"> 69</span></a>
</span><span id="PublisherClient-70"><a href="#PublisherClient-70"><span class="linenos"> 70</span></a>    <span class="nd">@classmethod</span>
</span><span id="PublisherClient-71"><a href="#PublisherClient-71"><span class="linenos"> 71</span></a>    <span class="k">def</span> <span class="nf">topic_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PublisherClient-72"><a href="#PublisherClient-72"><span class="linenos"> 72</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">project_path</span><span class="p">(</span><span class="n">project</span><span class="p">)</span><span class="si">}</span><span class="s1">/topics/</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="PublisherClient-73"><a href="#PublisherClient-73"><span class="linenos"> 73</span></a>
</span><span id="PublisherClient-74"><a href="#PublisherClient-74"><span class="linenos"> 74</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="PublisherClient-75"><a href="#PublisherClient-75"><span class="linenos"> 75</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PublisherClient-76"><a href="#PublisherClient-76"><span class="linenos"> 76</span></a>            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="PublisherClient-77"><a href="#PublisherClient-77"><span class="linenos"> 77</span></a>        <span class="p">}</span>
</span><span id="PublisherClient-78"><a href="#PublisherClient-78"><span class="linenos"> 78</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_is_dev</span><span class="p">:</span>
</span><span id="PublisherClient-79"><a href="#PublisherClient-79"><span class="linenos"> 79</span></a>            <span class="k">return</span> <span class="n">headers</span>
</span><span id="PublisherClient-80"><a href="#PublisherClient-80"><span class="linenos"> 80</span></a>
</span><span id="PublisherClient-81"><a href="#PublisherClient-81"><span class="linenos"> 81</span></a>        <span class="n">token</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="PublisherClient-82"><a href="#PublisherClient-82"><span class="linenos"> 82</span></a>        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="PublisherClient-83"><a href="#PublisherClient-83"><span class="linenos"> 83</span></a>        <span class="k">return</span> <span class="n">headers</span>
</span><span id="PublisherClient-84"><a href="#PublisherClient-84"><span class="linenos"> 84</span></a>
</span><span id="PublisherClient-85"><a href="#PublisherClient-85"><span class="linenos"> 85</span></a>    <span class="c1"># TODO: implement that various methods from:</span>
</span><span id="PublisherClient-86"><a href="#PublisherClient-86"><span class="linenos"> 86</span></a>    <span class="c1"># https://github.com/googleapis/python-pubsub/blob/master/google/cloud/pubsub_v1/gapic/publisher_client.py</span>
</span><span id="PublisherClient-87"><a href="#PublisherClient-87"><span class="linenos"> 87</span></a>
</span><span id="PublisherClient-88"><a href="#PublisherClient-88"><span class="linenos"> 88</span></a>    <span class="c1"># https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.topics/list</span>
</span><span id="PublisherClient-89"><a href="#PublisherClient-89"><span class="linenos"> 89</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">list_topics</span><span class="p">(</span>
</span><span id="PublisherClient-90"><a href="#PublisherClient-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PublisherClient-91"><a href="#PublisherClient-91"><span class="linenos"> 91</span></a>        <span class="n">query_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="PublisherClient-92"><a href="#PublisherClient-92"><span class="linenos"> 92</span></a>        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient-93"><a href="#PublisherClient-93"><span class="linenos"> 93</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="PublisherClient-94"><a href="#PublisherClient-94"><span class="linenos"> 94</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="PublisherClient-95"><a href="#PublisherClient-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PublisherClient-96"><a href="#PublisherClient-96"><span class="linenos"> 96</span></a><span class="sd">        List topics</span>
</span><span id="PublisherClient-97"><a href="#PublisherClient-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PublisherClient-98"><a href="#PublisherClient-98"><span class="linenos"> 98</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">project</span><span class="si">}</span><span class="s1">/topics&#39;</span>
</span><span id="PublisherClient-99"><a href="#PublisherClient-99"><span class="linenos"> 99</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="PublisherClient-100"><a href="#PublisherClient-100"><span class="linenos">100</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="PublisherClient-101"><a href="#PublisherClient-101"><span class="linenos">101</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="PublisherClient-102"><a href="#PublisherClient-102"><span class="linenos">102</span></a>            <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
</span><span id="PublisherClient-103"><a href="#PublisherClient-103"><span class="linenos">103</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
</span><span id="PublisherClient-104"><a href="#PublisherClient-104"><span class="linenos">104</span></a>        <span class="p">)</span>
</span><span id="PublisherClient-105"><a href="#PublisherClient-105"><span class="linenos">105</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="PublisherClient-106"><a href="#PublisherClient-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="PublisherClient-107"><a href="#PublisherClient-107"><span class="linenos">107</span></a>
</span><span id="PublisherClient-108"><a href="#PublisherClient-108"><span class="linenos">108</span></a>    <span class="c1"># https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.topics/create</span>
</span><span id="PublisherClient-109"><a href="#PublisherClient-109"><span class="linenos">109</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">create_topic</span><span class="p">(</span>
</span><span id="PublisherClient-110"><a href="#PublisherClient-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PublisherClient-111"><a href="#PublisherClient-111"><span class="linenos">111</span></a>        <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="PublisherClient-112"><a href="#PublisherClient-112"><span class="linenos">112</span></a>        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient-113"><a href="#PublisherClient-113"><span class="linenos">113</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="PublisherClient-114"><a href="#PublisherClient-114"><span class="linenos">114</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="PublisherClient-115"><a href="#PublisherClient-115"><span class="linenos">115</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PublisherClient-116"><a href="#PublisherClient-116"><span class="linenos">116</span></a><span class="sd">        Create topic.</span>
</span><span id="PublisherClient-117"><a href="#PublisherClient-117"><span class="linenos">117</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PublisherClient-118"><a href="#PublisherClient-118"><span class="linenos">118</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="PublisherClient-119"><a href="#PublisherClient-119"><span class="linenos">119</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="PublisherClient-120"><a href="#PublisherClient-120"><span class="linenos">120</span></a>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="PublisherClient-121"><a href="#PublisherClient-121"><span class="linenos">121</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="PublisherClient-122"><a href="#PublisherClient-122"><span class="linenos">122</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">encoded</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="PublisherClient-123"><a href="#PublisherClient-123"><span class="linenos">123</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="PublisherClient-124"><a href="#PublisherClient-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="PublisherClient-125"><a href="#PublisherClient-125"><span class="linenos">125</span></a>
</span><span id="PublisherClient-126"><a href="#PublisherClient-126"><span class="linenos">126</span></a>    <span class="c1"># https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.topics/delete</span>
</span><span id="PublisherClient-127"><a href="#PublisherClient-127"><span class="linenos">127</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">delete_topic</span><span class="p">(</span>
</span><span id="PublisherClient-128"><a href="#PublisherClient-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="PublisherClient-129"><a href="#PublisherClient-129"><span class="linenos">129</span></a>        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient-130"><a href="#PublisherClient-130"><span class="linenos">130</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="PublisherClient-131"><a href="#PublisherClient-131"><span class="linenos">131</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PublisherClient-132"><a href="#PublisherClient-132"><span class="linenos">132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PublisherClient-133"><a href="#PublisherClient-133"><span class="linenos">133</span></a><span class="sd">        Delete topic.</span>
</span><span id="PublisherClient-134"><a href="#PublisherClient-134"><span class="linenos">134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PublisherClient-135"><a href="#PublisherClient-135"><span class="linenos">135</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="PublisherClient-136"><a href="#PublisherClient-136"><span class="linenos">136</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="PublisherClient-137"><a href="#PublisherClient-137"><span class="linenos">137</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="PublisherClient-138"><a href="#PublisherClient-138"><span class="linenos">138</span></a>        <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="PublisherClient-139"><a href="#PublisherClient-139"><span class="linenos">139</span></a>
</span><span id="PublisherClient-140"><a href="#PublisherClient-140"><span class="linenos">140</span></a>    <span class="c1"># https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.topics/publish</span>
</span><span id="PublisherClient-141"><a href="#PublisherClient-141"><span class="linenos">141</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span>
</span><span id="PublisherClient-142"><a href="#PublisherClient-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PubsubMessage</span><span class="p">],</span>
</span><span id="PublisherClient-143"><a href="#PublisherClient-143"><span class="linenos">143</span></a>        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient-144"><a href="#PublisherClient-144"><span class="linenos">144</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="PublisherClient-145"><a href="#PublisherClient-145"><span class="linenos">145</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="PublisherClient-146"><a href="#PublisherClient-146"><span class="linenos">146</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">messages</span><span class="p">:</span>
</span><span id="PublisherClient-147"><a href="#PublisherClient-147"><span class="linenos">147</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="PublisherClient-148"><a href="#PublisherClient-148"><span class="linenos">148</span></a>
</span><span id="PublisherClient-149"><a href="#PublisherClient-149"><span class="linenos">149</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s1">:publish&#39;</span>
</span><span id="PublisherClient-150"><a href="#PublisherClient-150"><span class="linenos">150</span></a>
</span><span id="PublisherClient-151"><a href="#PublisherClient-151"><span class="linenos">151</span></a>        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;messages&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">to_repr</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">]}</span>
</span><span id="PublisherClient-152"><a href="#PublisherClient-152"><span class="linenos">152</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="PublisherClient-153"><a href="#PublisherClient-153"><span class="linenos">153</span></a>
</span><span id="PublisherClient-154"><a href="#PublisherClient-154"><span class="linenos">154</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="PublisherClient-155"><a href="#PublisherClient-155"><span class="linenos">155</span></a>        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
</span><span id="PublisherClient-156"><a href="#PublisherClient-156"><span class="linenos">156</span></a>
</span><span id="PublisherClient-157"><a href="#PublisherClient-157"><span class="linenos">157</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="PublisherClient-158"><a href="#PublisherClient-158"><span class="linenos">158</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PublisherClient-159"><a href="#PublisherClient-159"><span class="linenos">159</span></a>            <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
</span><span id="PublisherClient-160"><a href="#PublisherClient-160"><span class="linenos">160</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
</span><span id="PublisherClient-161"><a href="#PublisherClient-161"><span class="linenos">161</span></a>        <span class="p">)</span>
</span><span id="PublisherClient-162"><a href="#PublisherClient-162"><span class="linenos">162</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="PublisherClient-163"><a href="#PublisherClient-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="PublisherClient-164"><a href="#PublisherClient-164"><span class="linenos">164</span></a>
</span><span id="PublisherClient-165"><a href="#PublisherClient-165"><span class="linenos">165</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PublisherClient-166"><a href="#PublisherClient-166"><span class="linenos">166</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="PublisherClient-167"><a href="#PublisherClient-167"><span class="linenos">167</span></a>
</span><span id="PublisherClient-168"><a href="#PublisherClient-168"><span class="linenos">168</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PublisherClient&#39;</span><span class="p">:</span>
</span><span id="PublisherClient-169"><a href="#PublisherClient-169"><span class="linenos">169</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="PublisherClient-170"><a href="#PublisherClient-170"><span class="linenos">170</span></a>
</span><span id="PublisherClient-171"><a href="#PublisherClient-171"><span class="linenos">171</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PublisherClient-172"><a href="#PublisherClient-172"><span class="linenos">172</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


    

                            <div id="PublisherClient.__init__" class="classattr">
                                        <input id="PublisherClient.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PublisherClient</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">service_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IO</span><span class="p">[</span><span class="o">~</span><span class="n">AnyStr</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gcloud</span><span class="o">.</span><span class="n">aio</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">api_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="PublisherClient.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PublisherClient.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PublisherClient.__init__-49"><a href="#PublisherClient.__init__-49"><span class="linenos">49</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PublisherClient.__init__-50"><a href="#PublisherClient.__init__-50"><span class="linenos">50</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">service_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IO</span><span class="p">[</span><span class="n">AnyStr</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient.__init__-51"><a href="#PublisherClient.__init__-51"><span class="linenos">51</span></a>            <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient.__init__-52"><a href="#PublisherClient.__init__-52"><span class="linenos">52</span></a>            <span class="n">api_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient.__init__-53"><a href="#PublisherClient.__init__-53"><span class="linenos">53</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PublisherClient.__init__-54"><a href="#PublisherClient.__init__-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_api_is_dev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span> <span class="o">=</span> <span class="n">init_api_root</span><span class="p">(</span><span class="n">api_root</span><span class="p">)</span>
</span><span id="PublisherClient.__init__-55"><a href="#PublisherClient.__init__-55"><span class="linenos">55</span></a>
</span><span id="PublisherClient.__init__-56"><a href="#PublisherClient.__init__-56"><span class="linenos">56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">verify_ssl</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_is_dev</span><span class="p">)</span>
</span><span id="PublisherClient.__init__-57"><a href="#PublisherClient.__init__-57"><span class="linenos">57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span> <span class="ow">or</span> <span class="n">Token</span><span class="p">(</span>
</span><span id="PublisherClient.__init__-58"><a href="#PublisherClient.__init__-58"><span class="linenos">58</span></a>            <span class="n">service_file</span><span class="o">=</span><span class="n">service_file</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="n">SCOPES</span><span class="p">,</span>
</span><span id="PublisherClient.__init__-59"><a href="#PublisherClient.__init__-59"><span class="linenos">59</span></a>            <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="PublisherClient.__init__-60"><a href="#PublisherClient.__init__-60"><span class="linenos">60</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="PublisherClient.project_path" class="classattr">
                                        <input id="PublisherClient.project_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">project_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">project</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="PublisherClient.project_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PublisherClient.project_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PublisherClient.project_path-62"><a href="#PublisherClient.project_path-62"><span class="linenos">62</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PublisherClient.project_path-63"><a href="#PublisherClient.project_path-63"><span class="linenos">63</span></a>    <span class="k">def</span> <span class="nf">project_path</span><span class="p">(</span><span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PublisherClient.project_path-64"><a href="#PublisherClient.project_path-64"><span class="linenos">64</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;projects/</span><span class="si">{</span><span class="n">project</span><span class="si">}</span><span class="s1">&#39;</span>
</span></pre></div>


    

                            </div>
                            <div id="PublisherClient.subscription_path" class="classattr">
                                        <input id="PublisherClient.subscription_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">subscription_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">project</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="PublisherClient.subscription_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PublisherClient.subscription_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PublisherClient.subscription_path-66"><a href="#PublisherClient.subscription_path-66"><span class="linenos">66</span></a>    <span class="nd">@classmethod</span>
</span><span id="PublisherClient.subscription_path-67"><a href="#PublisherClient.subscription_path-67"><span class="linenos">67</span></a>    <span class="k">def</span> <span class="nf">subscription_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PublisherClient.subscription_path-68"><a href="#PublisherClient.subscription_path-68"><span class="linenos">68</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">project_path</span><span class="p">(</span><span class="n">project</span><span class="p">)</span><span class="si">}</span><span class="s1">/subscriptions/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">&#39;</span>
</span></pre></div>


    

                            </div>
                            <div id="PublisherClient.topic_path" class="classattr">
                                        <input id="PublisherClient.topic_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">topic_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">project</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">topic</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="PublisherClient.topic_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PublisherClient.topic_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PublisherClient.topic_path-70"><a href="#PublisherClient.topic_path-70"><span class="linenos">70</span></a>    <span class="nd">@classmethod</span>
</span><span id="PublisherClient.topic_path-71"><a href="#PublisherClient.topic_path-71"><span class="linenos">71</span></a>    <span class="k">def</span> <span class="nf">topic_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PublisherClient.topic_path-72"><a href="#PublisherClient.topic_path-72"><span class="linenos">72</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">project_path</span><span class="p">(</span><span class="n">project</span><span class="p">)</span><span class="si">}</span><span class="s1">/topics/</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s1">&#39;</span>
</span></pre></div>


    

                            </div>
                            <div id="PublisherClient.list_topics" class="classattr">
                                        <input id="PublisherClient.list_topics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">list_topics</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">project</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">query_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PublisherClient.list_topics-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PublisherClient.list_topics"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PublisherClient.list_topics-89"><a href="#PublisherClient.list_topics-89"><span class="linenos"> 89</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">list_topics</span><span class="p">(</span>
</span><span id="PublisherClient.list_topics-90"><a href="#PublisherClient.list_topics-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PublisherClient.list_topics-91"><a href="#PublisherClient.list_topics-91"><span class="linenos"> 91</span></a>        <span class="n">query_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="PublisherClient.list_topics-92"><a href="#PublisherClient.list_topics-92"><span class="linenos"> 92</span></a>        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient.list_topics-93"><a href="#PublisherClient.list_topics-93"><span class="linenos"> 93</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="PublisherClient.list_topics-94"><a href="#PublisherClient.list_topics-94"><span class="linenos"> 94</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="PublisherClient.list_topics-95"><a href="#PublisherClient.list_topics-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PublisherClient.list_topics-96"><a href="#PublisherClient.list_topics-96"><span class="linenos"> 96</span></a><span class="sd">        List topics</span>
</span><span id="PublisherClient.list_topics-97"><a href="#PublisherClient.list_topics-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PublisherClient.list_topics-98"><a href="#PublisherClient.list_topics-98"><span class="linenos"> 98</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">project</span><span class="si">}</span><span class="s1">/topics&#39;</span>
</span><span id="PublisherClient.list_topics-99"><a href="#PublisherClient.list_topics-99"><span class="linenos"> 99</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="PublisherClient.list_topics-100"><a href="#PublisherClient.list_topics-100"><span class="linenos">100</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="PublisherClient.list_topics-101"><a href="#PublisherClient.list_topics-101"><span class="linenos">101</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="PublisherClient.list_topics-102"><a href="#PublisherClient.list_topics-102"><span class="linenos">102</span></a>            <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
</span><span id="PublisherClient.list_topics-103"><a href="#PublisherClient.list_topics-103"><span class="linenos">103</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
</span><span id="PublisherClient.list_topics-104"><a href="#PublisherClient.list_topics-104"><span class="linenos">104</span></a>        <span class="p">)</span>
</span><span id="PublisherClient.list_topics-105"><a href="#PublisherClient.list_topics-105"><span class="linenos">105</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="PublisherClient.list_topics-106"><a href="#PublisherClient.list_topics-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>List topics</p>
</div>


                            </div>
                            <div id="PublisherClient.create_topic" class="classattr">
                                        <input id="PublisherClient.create_topic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">create_topic</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">topic</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PublisherClient.create_topic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PublisherClient.create_topic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PublisherClient.create_topic-109"><a href="#PublisherClient.create_topic-109"><span class="linenos">109</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">create_topic</span><span class="p">(</span>
</span><span id="PublisherClient.create_topic-110"><a href="#PublisherClient.create_topic-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PublisherClient.create_topic-111"><a href="#PublisherClient.create_topic-111"><span class="linenos">111</span></a>        <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="PublisherClient.create_topic-112"><a href="#PublisherClient.create_topic-112"><span class="linenos">112</span></a>        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient.create_topic-113"><a href="#PublisherClient.create_topic-113"><span class="linenos">113</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="PublisherClient.create_topic-114"><a href="#PublisherClient.create_topic-114"><span class="linenos">114</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="PublisherClient.create_topic-115"><a href="#PublisherClient.create_topic-115"><span class="linenos">115</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PublisherClient.create_topic-116"><a href="#PublisherClient.create_topic-116"><span class="linenos">116</span></a><span class="sd">        Create topic.</span>
</span><span id="PublisherClient.create_topic-117"><a href="#PublisherClient.create_topic-117"><span class="linenos">117</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PublisherClient.create_topic-118"><a href="#PublisherClient.create_topic-118"><span class="linenos">118</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="PublisherClient.create_topic-119"><a href="#PublisherClient.create_topic-119"><span class="linenos">119</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="PublisherClient.create_topic-120"><a href="#PublisherClient.create_topic-120"><span class="linenos">120</span></a>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="PublisherClient.create_topic-121"><a href="#PublisherClient.create_topic-121"><span class="linenos">121</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="PublisherClient.create_topic-122"><a href="#PublisherClient.create_topic-122"><span class="linenos">122</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">encoded</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="PublisherClient.create_topic-123"><a href="#PublisherClient.create_topic-123"><span class="linenos">123</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="PublisherClient.create_topic-124"><a href="#PublisherClient.create_topic-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Create topic.</p>
</div>


                            </div>
                            <div id="PublisherClient.delete_topic" class="classattr">
                                        <input id="PublisherClient.delete_topic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">delete_topic</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">topic</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="PublisherClient.delete_topic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PublisherClient.delete_topic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PublisherClient.delete_topic-127"><a href="#PublisherClient.delete_topic-127"><span class="linenos">127</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">delete_topic</span><span class="p">(</span>
</span><span id="PublisherClient.delete_topic-128"><a href="#PublisherClient.delete_topic-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="PublisherClient.delete_topic-129"><a href="#PublisherClient.delete_topic-129"><span class="linenos">129</span></a>        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient.delete_topic-130"><a href="#PublisherClient.delete_topic-130"><span class="linenos">130</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="PublisherClient.delete_topic-131"><a href="#PublisherClient.delete_topic-131"><span class="linenos">131</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PublisherClient.delete_topic-132"><a href="#PublisherClient.delete_topic-132"><span class="linenos">132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PublisherClient.delete_topic-133"><a href="#PublisherClient.delete_topic-133"><span class="linenos">133</span></a><span class="sd">        Delete topic.</span>
</span><span id="PublisherClient.delete_topic-134"><a href="#PublisherClient.delete_topic-134"><span class="linenos">134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PublisherClient.delete_topic-135"><a href="#PublisherClient.delete_topic-135"><span class="linenos">135</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="PublisherClient.delete_topic-136"><a href="#PublisherClient.delete_topic-136"><span class="linenos">136</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="PublisherClient.delete_topic-137"><a href="#PublisherClient.delete_topic-137"><span class="linenos">137</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="PublisherClient.delete_topic-138"><a href="#PublisherClient.delete_topic-138"><span class="linenos">138</span></a>        <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Delete topic.</p>
</div>


                            </div>
                            <div id="PublisherClient.publish" class="classattr">
                                        <input id="PublisherClient.publish-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">publish</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">topic</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#PubsubMessage">gcloud.aio.pubsub.PubsubMessage</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PublisherClient.publish-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PublisherClient.publish"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PublisherClient.publish-141"><a href="#PublisherClient.publish-141"><span class="linenos">141</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span>
</span><span id="PublisherClient.publish-142"><a href="#PublisherClient.publish-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PubsubMessage</span><span class="p">],</span>
</span><span id="PublisherClient.publish-143"><a href="#PublisherClient.publish-143"><span class="linenos">143</span></a>        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PublisherClient.publish-144"><a href="#PublisherClient.publish-144"><span class="linenos">144</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="PublisherClient.publish-145"><a href="#PublisherClient.publish-145"><span class="linenos">145</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="PublisherClient.publish-146"><a href="#PublisherClient.publish-146"><span class="linenos">146</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">messages</span><span class="p">:</span>
</span><span id="PublisherClient.publish-147"><a href="#PublisherClient.publish-147"><span class="linenos">147</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="PublisherClient.publish-148"><a href="#PublisherClient.publish-148"><span class="linenos">148</span></a>
</span><span id="PublisherClient.publish-149"><a href="#PublisherClient.publish-149"><span class="linenos">149</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s1">:publish&#39;</span>
</span><span id="PublisherClient.publish-150"><a href="#PublisherClient.publish-150"><span class="linenos">150</span></a>
</span><span id="PublisherClient.publish-151"><a href="#PublisherClient.publish-151"><span class="linenos">151</span></a>        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;messages&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">to_repr</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">]}</span>
</span><span id="PublisherClient.publish-152"><a href="#PublisherClient.publish-152"><span class="linenos">152</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="PublisherClient.publish-153"><a href="#PublisherClient.publish-153"><span class="linenos">153</span></a>
</span><span id="PublisherClient.publish-154"><a href="#PublisherClient.publish-154"><span class="linenos">154</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="PublisherClient.publish-155"><a href="#PublisherClient.publish-155"><span class="linenos">155</span></a>        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
</span><span id="PublisherClient.publish-156"><a href="#PublisherClient.publish-156"><span class="linenos">156</span></a>
</span><span id="PublisherClient.publish-157"><a href="#PublisherClient.publish-157"><span class="linenos">157</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="PublisherClient.publish-158"><a href="#PublisherClient.publish-158"><span class="linenos">158</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PublisherClient.publish-159"><a href="#PublisherClient.publish-159"><span class="linenos">159</span></a>            <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
</span><span id="PublisherClient.publish-160"><a href="#PublisherClient.publish-160"><span class="linenos">160</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
</span><span id="PublisherClient.publish-161"><a href="#PublisherClient.publish-161"><span class="linenos">161</span></a>        <span class="p">)</span>
</span><span id="PublisherClient.publish-162"><a href="#PublisherClient.publish-162"><span class="linenos">162</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="PublisherClient.publish-163"><a href="#PublisherClient.publish-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="n">data</span>
</span></pre></div>


    

                            </div>
                            <div id="PublisherClient.close" class="classattr">
                                        <input id="PublisherClient.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="PublisherClient.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PublisherClient.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PublisherClient.close-165"><a href="#PublisherClient.close-165"><span class="linenos">165</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PublisherClient.close-166"><a href="#PublisherClient.close-166"><span class="linenos">166</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="PubsubMessage">
                            <input id="PubsubMessage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PubsubMessage</span>:

                <label class="view-source-button" for="PubsubMessage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PubsubMessage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PubsubMessage-10"><a href="#PubsubMessage-10"><span class="linenos">10</span></a><span class="k">class</span> <span class="nc">PubsubMessage</span><span class="p">:</span>
</span><span id="PubsubMessage-11"><a href="#PubsubMessage-11"><span class="linenos">11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PubsubMessage-12"><a href="#PubsubMessage-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">ordering_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="PubsubMessage-13"><a href="#PubsubMessage-13"><span class="linenos">13</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="PubsubMessage-14"><a href="#PubsubMessage-14"><span class="linenos">14</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PubsubMessage-15"><a href="#PubsubMessage-15"><span class="linenos">15</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="PubsubMessage-16"><a href="#PubsubMessage-16"><span class="linenos">16</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span id="PubsubMessage-17"><a href="#PubsubMessage-17"><span class="linenos">17</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ordering_key</span> <span class="o">=</span> <span class="n">ordering_key</span>
</span><span id="PubsubMessage-18"><a href="#PubsubMessage-18"><span class="linenos">18</span></a>
</span><span id="PubsubMessage-19"><a href="#PubsubMessage-19"><span class="linenos">19</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PubsubMessage-20"><a href="#PubsubMessage-20"><span class="linenos">20</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_repr</span><span class="p">())</span>
</span><span id="PubsubMessage-21"><a href="#PubsubMessage-21"><span class="linenos">21</span></a>
</span><span id="PubsubMessage-22"><a href="#PubsubMessage-22"><span class="linenos">22</span></a>    <span class="k">def</span> <span class="nf">to_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="PubsubMessage-23"><a href="#PubsubMessage-23"><span class="linenos">23</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PubsubMessage-24"><a href="#PubsubMessage-24"><span class="linenos">24</span></a>            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
</span><span id="PubsubMessage-25"><a href="#PubsubMessage-25"><span class="linenos">25</span></a>            <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span>
</span><span id="PubsubMessage-26"><a href="#PubsubMessage-26"><span class="linenos">26</span></a>        <span class="p">}</span>
</span><span id="PubsubMessage-27"><a href="#PubsubMessage-27"><span class="linenos">27</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordering_key</span><span class="p">:</span>
</span><span id="PubsubMessage-28"><a href="#PubsubMessage-28"><span class="linenos">28</span></a>            <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;orderingKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordering_key</span>
</span><span id="PubsubMessage-29"><a href="#PubsubMessage-29"><span class="linenos">29</span></a>        <span class="k">return</span> <span class="n">msg</span>
</span></pre></div>


    

                            <div id="PubsubMessage.__init__" class="classattr">
                                        <input id="PubsubMessage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PubsubMessage</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>, </span><span class="param"><span class="n">ordering_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="PubsubMessage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PubsubMessage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PubsubMessage.__init__-11"><a href="#PubsubMessage.__init__-11"><span class="linenos">11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PubsubMessage.__init__-12"><a href="#PubsubMessage.__init__-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">ordering_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="PubsubMessage.__init__-13"><a href="#PubsubMessage.__init__-13"><span class="linenos">13</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="PubsubMessage.__init__-14"><a href="#PubsubMessage.__init__-14"><span class="linenos">14</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PubsubMessage.__init__-15"><a href="#PubsubMessage.__init__-15"><span class="linenos">15</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="PubsubMessage.__init__-16"><a href="#PubsubMessage.__init__-16"><span class="linenos">16</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span id="PubsubMessage.__init__-17"><a href="#PubsubMessage.__init__-17"><span class="linenos">17</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ordering_key</span> <span class="o">=</span> <span class="n">ordering_key</span>
</span></pre></div>


    

                            </div>
                            <div id="PubsubMessage.to_repr" class="classattr">
                                        <input id="PubsubMessage.to_repr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_repr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PubsubMessage.to_repr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PubsubMessage.to_repr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PubsubMessage.to_repr-22"><a href="#PubsubMessage.to_repr-22"><span class="linenos">22</span></a>    <span class="k">def</span> <span class="nf">to_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="PubsubMessage.to_repr-23"><a href="#PubsubMessage.to_repr-23"><span class="linenos">23</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PubsubMessage.to_repr-24"><a href="#PubsubMessage.to_repr-24"><span class="linenos">24</span></a>            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
</span><span id="PubsubMessage.to_repr-25"><a href="#PubsubMessage.to_repr-25"><span class="linenos">25</span></a>            <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span>
</span><span id="PubsubMessage.to_repr-26"><a href="#PubsubMessage.to_repr-26"><span class="linenos">26</span></a>        <span class="p">}</span>
</span><span id="PubsubMessage.to_repr-27"><a href="#PubsubMessage.to_repr-27"><span class="linenos">27</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordering_key</span><span class="p">:</span>
</span><span id="PubsubMessage.to_repr-28"><a href="#PubsubMessage.to_repr-28"><span class="linenos">28</span></a>            <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;orderingKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordering_key</span>
</span><span id="PubsubMessage.to_repr-29"><a href="#PubsubMessage.to_repr-29"><span class="linenos">29</span></a>        <span class="k">return</span> <span class="n">msg</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="SubscriberClient">
                            <input id="SubscriberClient-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SubscriberClient</span>:

                <label class="view-source-button" for="SubscriberClient-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberClient"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberClient-41"><a href="#SubscriberClient-41"><span class="linenos"> 41</span></a><span class="k">class</span> <span class="nc">SubscriberClient</span><span class="p">:</span>
</span><span id="SubscriberClient-42"><a href="#SubscriberClient-42"><span class="linenos"> 42</span></a>    <span class="n">_api_root</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="SubscriberClient-43"><a href="#SubscriberClient-43"><span class="linenos"> 43</span></a>    <span class="n">_api_is_dev</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="SubscriberClient-44"><a href="#SubscriberClient-44"><span class="linenos"> 44</span></a>
</span><span id="SubscriberClient-45"><a href="#SubscriberClient-45"><span class="linenos"> 45</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SubscriberClient-46"><a href="#SubscriberClient-46"><span class="linenos"> 46</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">service_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IO</span><span class="p">[</span><span class="n">AnyStr</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient-47"><a href="#SubscriberClient-47"><span class="linenos"> 47</span></a>            <span class="n">token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient-48"><a href="#SubscriberClient-48"><span class="linenos"> 48</span></a>            <span class="n">api_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient-49"><a href="#SubscriberClient-49"><span class="linenos"> 49</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberClient-50"><a href="#SubscriberClient-50"><span class="linenos"> 50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_api_is_dev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span> <span class="o">=</span> <span class="n">init_api_root</span><span class="p">(</span><span class="n">api_root</span><span class="p">)</span>
</span><span id="SubscriberClient-51"><a href="#SubscriberClient-51"><span class="linenos"> 51</span></a>
</span><span id="SubscriberClient-52"><a href="#SubscriberClient-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">verify_ssl</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_is_dev</span><span class="p">)</span>
</span><span id="SubscriberClient-53"><a href="#SubscriberClient-53"><span class="linenos"> 53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span> <span class="ow">or</span> <span class="n">Token</span><span class="p">(</span>
</span><span id="SubscriberClient-54"><a href="#SubscriberClient-54"><span class="linenos"> 54</span></a>            <span class="n">service_file</span><span class="o">=</span><span class="n">service_file</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="n">SCOPES</span><span class="p">,</span>
</span><span id="SubscriberClient-55"><a href="#SubscriberClient-55"><span class="linenos"> 55</span></a>            <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="SubscriberClient-56"><a href="#SubscriberClient-56"><span class="linenos"> 56</span></a>        <span class="p">)</span>
</span><span id="SubscriberClient-57"><a href="#SubscriberClient-57"><span class="linenos"> 57</span></a>
</span><span id="SubscriberClient-58"><a href="#SubscriberClient-58"><span class="linenos"> 58</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SubscriberClient-59"><a href="#SubscriberClient-59"><span class="linenos"> 59</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SubscriberClient-60"><a href="#SubscriberClient-60"><span class="linenos"> 60</span></a>            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="SubscriberClient-61"><a href="#SubscriberClient-61"><span class="linenos"> 61</span></a>        <span class="p">}</span>
</span><span id="SubscriberClient-62"><a href="#SubscriberClient-62"><span class="linenos"> 62</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_is_dev</span><span class="p">:</span>
</span><span id="SubscriberClient-63"><a href="#SubscriberClient-63"><span class="linenos"> 63</span></a>            <span class="k">return</span> <span class="n">headers</span>
</span><span id="SubscriberClient-64"><a href="#SubscriberClient-64"><span class="linenos"> 64</span></a>
</span><span id="SubscriberClient-65"><a href="#SubscriberClient-65"><span class="linenos"> 65</span></a>        <span class="n">token</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="SubscriberClient-66"><a href="#SubscriberClient-66"><span class="linenos"> 66</span></a>        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="SubscriberClient-67"><a href="#SubscriberClient-67"><span class="linenos"> 67</span></a>        <span class="k">return</span> <span class="n">headers</span>
</span><span id="SubscriberClient-68"><a href="#SubscriberClient-68"><span class="linenos"> 68</span></a>
</span><span id="SubscriberClient-69"><a href="#SubscriberClient-69"><span class="linenos"> 69</span></a>    <span class="c1"># https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.subscriptions/create</span>
</span><span id="SubscriberClient-70"><a href="#SubscriberClient-70"><span class="linenos"> 70</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">create_subscription</span><span class="p">(</span>
</span><span id="SubscriberClient-71"><a href="#SubscriberClient-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SubscriberClient-72"><a href="#SubscriberClient-72"><span class="linenos"> 72</span></a>        <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SubscriberClient-73"><a href="#SubscriberClient-73"><span class="linenos"> 73</span></a>        <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SubscriberClient-74"><a href="#SubscriberClient-74"><span class="linenos"> 74</span></a>        <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient-75"><a href="#SubscriberClient-75"><span class="linenos"> 75</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="SubscriberClient-76"><a href="#SubscriberClient-76"><span class="linenos"> 76</span></a>        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient-77"><a href="#SubscriberClient-77"><span class="linenos"> 77</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SubscriberClient-78"><a href="#SubscriberClient-78"><span class="linenos"> 78</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SubscriberClient-79"><a href="#SubscriberClient-79"><span class="linenos"> 79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient-80"><a href="#SubscriberClient-80"><span class="linenos"> 80</span></a><span class="sd">        Create subscription.</span>
</span><span id="SubscriberClient-81"><a href="#SubscriberClient-81"><span class="linenos"> 81</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient-82"><a href="#SubscriberClient-82"><span class="linenos"> 82</span></a>        <span class="n">body</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">body</span> <span class="k">else</span> <span class="n">body</span>
</span><span id="SubscriberClient-83"><a href="#SubscriberClient-83"><span class="linenos"> 83</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="SubscriberClient-84"><a href="#SubscriberClient-84"><span class="linenos"> 84</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient-85"><a href="#SubscriberClient-85"><span class="linenos"> 85</span></a>        <span class="n">payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span id="SubscriberClient-86"><a href="#SubscriberClient-86"><span class="linenos"> 86</span></a>        <span class="n">payload</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="n">topic</span><span class="p">})</span>
</span><span id="SubscriberClient-87"><a href="#SubscriberClient-87"><span class="linenos"> 87</span></a>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="SubscriberClient-88"><a href="#SubscriberClient-88"><span class="linenos"> 88</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient-89"><a href="#SubscriberClient-89"><span class="linenos"> 89</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">encoded</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="SubscriberClient-90"><a href="#SubscriberClient-90"><span class="linenos"> 90</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="SubscriberClient-91"><a href="#SubscriberClient-91"><span class="linenos"> 91</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="SubscriberClient-92"><a href="#SubscriberClient-92"><span class="linenos"> 92</span></a>
</span><span id="SubscriberClient-93"><a href="#SubscriberClient-93"><span class="linenos"> 93</span></a>    <span class="c1"># https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.subscriptions/delete</span>
</span><span id="SubscriberClient-94"><a href="#SubscriberClient-94"><span class="linenos"> 94</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">delete_subscription</span><span class="p">(</span>
</span><span id="SubscriberClient-95"><a href="#SubscriberClient-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="SubscriberClient-96"><a href="#SubscriberClient-96"><span class="linenos"> 96</span></a>        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient-97"><a href="#SubscriberClient-97"><span class="linenos"> 97</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SubscriberClient-98"><a href="#SubscriberClient-98"><span class="linenos"> 98</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberClient-99"><a href="#SubscriberClient-99"><span class="linenos"> 99</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient-100"><a href="#SubscriberClient-100"><span class="linenos">100</span></a><span class="sd">        Delete subscription.</span>
</span><span id="SubscriberClient-101"><a href="#SubscriberClient-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient-102"><a href="#SubscriberClient-102"><span class="linenos">102</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="SubscriberClient-103"><a href="#SubscriberClient-103"><span class="linenos">103</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient-104"><a href="#SubscriberClient-104"><span class="linenos">104</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient-105"><a href="#SubscriberClient-105"><span class="linenos">105</span></a>        <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="SubscriberClient-106"><a href="#SubscriberClient-106"><span class="linenos">106</span></a>
</span><span id="SubscriberClient-107"><a href="#SubscriberClient-107"><span class="linenos">107</span></a>    <span class="c1"># https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.subscriptions/pull</span>
</span><span id="SubscriberClient-108"><a href="#SubscriberClient-108"><span class="linenos">108</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span>
</span><span id="SubscriberClient-109"><a href="#SubscriberClient-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_messages</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="SubscriberClient-110"><a href="#SubscriberClient-110"><span class="linenos">110</span></a>        <span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient-111"><a href="#SubscriberClient-111"><span class="linenos">111</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>
</span><span id="SubscriberClient-112"><a href="#SubscriberClient-112"><span class="linenos">112</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SubscriberMessage</span><span class="p">]:</span>
</span><span id="SubscriberClient-113"><a href="#SubscriberClient-113"><span class="linenos">113</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient-114"><a href="#SubscriberClient-114"><span class="linenos">114</span></a><span class="sd">        Pull messages from subscription</span>
</span><span id="SubscriberClient-115"><a href="#SubscriberClient-115"><span class="linenos">115</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient-116"><a href="#SubscriberClient-116"><span class="linenos">116</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">:pull&#39;</span>
</span><span id="SubscriberClient-117"><a href="#SubscriberClient-117"><span class="linenos">117</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient-118"><a href="#SubscriberClient-118"><span class="linenos">118</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SubscriberClient-119"><a href="#SubscriberClient-119"><span class="linenos">119</span></a>            <span class="s1">&#39;maxMessages&#39;</span><span class="p">:</span> <span class="n">max_messages</span><span class="p">,</span>
</span><span id="SubscriberClient-120"><a href="#SubscriberClient-120"><span class="linenos">120</span></a>        <span class="p">}</span>
</span><span id="SubscriberClient-121"><a href="#SubscriberClient-121"><span class="linenos">121</span></a>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="SubscriberClient-122"><a href="#SubscriberClient-122"><span class="linenos">122</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient-123"><a href="#SubscriberClient-123"><span class="linenos">123</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="SubscriberClient-124"><a href="#SubscriberClient-124"><span class="linenos">124</span></a>            <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">encoded</span><span class="p">,</span>
</span><span id="SubscriberClient-125"><a href="#SubscriberClient-125"><span class="linenos">125</span></a>            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
</span><span id="SubscriberClient-126"><a href="#SubscriberClient-126"><span class="linenos">126</span></a>        <span class="p">)</span>
</span><span id="SubscriberClient-127"><a href="#SubscriberClient-127"><span class="linenos">127</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="SubscriberClient-128"><a href="#SubscriberClient-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="SubscriberClient-129"><a href="#SubscriberClient-129"><span class="linenos">129</span></a>            <span class="n">SubscriberMessage</span><span class="o">.</span><span class="n">from_repr</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="SubscriberClient-130"><a href="#SubscriberClient-130"><span class="linenos">130</span></a>            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;receivedMessages&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="SubscriberClient-131"><a href="#SubscriberClient-131"><span class="linenos">131</span></a>        <span class="p">]</span>
</span><span id="SubscriberClient-132"><a href="#SubscriberClient-132"><span class="linenos">132</span></a>
</span><span id="SubscriberClient-133"><a href="#SubscriberClient-133"><span class="linenos">133</span></a>    <span class="c1"># https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.subscriptions/acknowledge</span>
</span><span id="SubscriberClient-134"><a href="#SubscriberClient-134"><span class="linenos">134</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">acknowledge</span><span class="p">(</span>
</span><span id="SubscriberClient-135"><a href="#SubscriberClient-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ack_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="SubscriberClient-136"><a href="#SubscriberClient-136"><span class="linenos">136</span></a>        <span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient-137"><a href="#SubscriberClient-137"><span class="linenos">137</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SubscriberClient-138"><a href="#SubscriberClient-138"><span class="linenos">138</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberClient-139"><a href="#SubscriberClient-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient-140"><a href="#SubscriberClient-140"><span class="linenos">140</span></a><span class="sd">        Acknowledge messages by ackIds</span>
</span><span id="SubscriberClient-141"><a href="#SubscriberClient-141"><span class="linenos">141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient-142"><a href="#SubscriberClient-142"><span class="linenos">142</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">:acknowledge&#39;</span>
</span><span id="SubscriberClient-143"><a href="#SubscriberClient-143"><span class="linenos">143</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient-144"><a href="#SubscriberClient-144"><span class="linenos">144</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SubscriberClient-145"><a href="#SubscriberClient-145"><span class="linenos">145</span></a>            <span class="s1">&#39;ackIds&#39;</span><span class="p">:</span> <span class="n">ack_ids</span><span class="p">,</span>
</span><span id="SubscriberClient-146"><a href="#SubscriberClient-146"><span class="linenos">146</span></a>        <span class="p">}</span>
</span><span id="SubscriberClient-147"><a href="#SubscriberClient-147"><span class="linenos">147</span></a>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="SubscriberClient-148"><a href="#SubscriberClient-148"><span class="linenos">148</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient-149"><a href="#SubscriberClient-149"><span class="linenos">149</span></a>        <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">encoded</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="SubscriberClient-150"><a href="#SubscriberClient-150"><span class="linenos">150</span></a>
</span><span id="SubscriberClient-151"><a href="#SubscriberClient-151"><span class="linenos">151</span></a>    <span class="c1"># https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.subscriptions/modifyAckDeadline</span>
</span><span id="SubscriberClient-152"><a href="#SubscriberClient-152"><span class="linenos">152</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">modify_ack_deadline</span><span class="p">(</span>
</span><span id="SubscriberClient-153"><a href="#SubscriberClient-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SubscriberClient-154"><a href="#SubscriberClient-154"><span class="linenos">154</span></a>        <span class="n">ack_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="SubscriberClient-155"><a href="#SubscriberClient-155"><span class="linenos">155</span></a>        <span class="n">ack_deadline_seconds</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="SubscriberClient-156"><a href="#SubscriberClient-156"><span class="linenos">156</span></a>        <span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient-157"><a href="#SubscriberClient-157"><span class="linenos">157</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SubscriberClient-158"><a href="#SubscriberClient-158"><span class="linenos">158</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberClient-159"><a href="#SubscriberClient-159"><span class="linenos">159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient-160"><a href="#SubscriberClient-160"><span class="linenos">160</span></a><span class="sd">        Modify messages&#39; ack deadline.</span>
</span><span id="SubscriberClient-161"><a href="#SubscriberClient-161"><span class="linenos">161</span></a><span class="sd">        Set ack deadline to 0 to nack messages.</span>
</span><span id="SubscriberClient-162"><a href="#SubscriberClient-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient-163"><a href="#SubscriberClient-163"><span class="linenos">163</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">:modifyAckDeadline&#39;</span>
</span><span id="SubscriberClient-164"><a href="#SubscriberClient-164"><span class="linenos">164</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient-165"><a href="#SubscriberClient-165"><span class="linenos">165</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="SubscriberClient-166"><a href="#SubscriberClient-166"><span class="linenos">166</span></a>            <span class="s1">&#39;ackIds&#39;</span><span class="p">:</span> <span class="n">ack_ids</span><span class="p">,</span>
</span><span id="SubscriberClient-167"><a href="#SubscriberClient-167"><span class="linenos">167</span></a>            <span class="s1">&#39;ackDeadlineSeconds&#39;</span><span class="p">:</span> <span class="n">ack_deadline_seconds</span><span class="p">,</span>
</span><span id="SubscriberClient-168"><a href="#SubscriberClient-168"><span class="linenos">168</span></a>        <span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="SubscriberClient-169"><a href="#SubscriberClient-169"><span class="linenos">169</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient-170"><a href="#SubscriberClient-170"><span class="linenos">170</span></a>        <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="SubscriberClient-171"><a href="#SubscriberClient-171"><span class="linenos">171</span></a>
</span><span id="SubscriberClient-172"><a href="#SubscriberClient-172"><span class="linenos">172</span></a>    <span class="c1"># https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.subscriptions/get</span>
</span><span id="SubscriberClient-173"><a href="#SubscriberClient-173"><span class="linenos">173</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_subscription</span><span class="p">(</span>
</span><span id="SubscriberClient-174"><a href="#SubscriberClient-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SubscriberClient-175"><a href="#SubscriberClient-175"><span class="linenos">175</span></a>        <span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient-176"><a href="#SubscriberClient-176"><span class="linenos">176</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SubscriberClient-177"><a href="#SubscriberClient-177"><span class="linenos">177</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SubscriberClient-178"><a href="#SubscriberClient-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient-179"><a href="#SubscriberClient-179"><span class="linenos">179</span></a><span class="sd">        Get Subscription</span>
</span><span id="SubscriberClient-180"><a href="#SubscriberClient-180"><span class="linenos">180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient-181"><a href="#SubscriberClient-181"><span class="linenos">181</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="SubscriberClient-182"><a href="#SubscriberClient-182"><span class="linenos">182</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient-183"><a href="#SubscriberClient-183"><span class="linenos">183</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient-184"><a href="#SubscriberClient-184"><span class="linenos">184</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="SubscriberClient-185"><a href="#SubscriberClient-185"><span class="linenos">185</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="SubscriberClient-186"><a href="#SubscriberClient-186"><span class="linenos">186</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="SubscriberClient-187"><a href="#SubscriberClient-187"><span class="linenos">187</span></a>
</span><span id="SubscriberClient-188"><a href="#SubscriberClient-188"><span class="linenos">188</span></a>    <span class="c1"># https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.subscriptions/list</span>
</span><span id="SubscriberClient-189"><a href="#SubscriberClient-189"><span class="linenos">189</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">list_subscriptions</span><span class="p">(</span>
</span><span id="SubscriberClient-190"><a href="#SubscriberClient-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SubscriberClient-191"><a href="#SubscriberClient-191"><span class="linenos">191</span></a>        <span class="n">query_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient-192"><a href="#SubscriberClient-192"><span class="linenos">192</span></a>        <span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient-193"><a href="#SubscriberClient-193"><span class="linenos">193</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SubscriberClient-194"><a href="#SubscriberClient-194"><span class="linenos">194</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SubscriberClient-195"><a href="#SubscriberClient-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient-196"><a href="#SubscriberClient-196"><span class="linenos">196</span></a><span class="sd">        List subscriptions</span>
</span><span id="SubscriberClient-197"><a href="#SubscriberClient-197"><span class="linenos">197</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient-198"><a href="#SubscriberClient-198"><span class="linenos">198</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">project</span><span class="si">}</span><span class="s1">/subscriptions&#39;</span>
</span><span id="SubscriberClient-199"><a href="#SubscriberClient-199"><span class="linenos">199</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient-200"><a href="#SubscriberClient-200"><span class="linenos">200</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient-201"><a href="#SubscriberClient-201"><span class="linenos">201</span></a>
</span><span id="SubscriberClient-202"><a href="#SubscriberClient-202"><span class="linenos">202</span></a>        <span class="n">all_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">:</span> <span class="p">[]}</span>
</span><span id="SubscriberClient-203"><a href="#SubscriberClient-203"><span class="linenos">203</span></a>        <span class="n">nextPageToken</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SubscriberClient-204"><a href="#SubscriberClient-204"><span class="linenos">204</span></a>        <span class="n">next_query_params</span> <span class="o">=</span> <span class="n">query_params</span> <span class="k">if</span> <span class="n">query_params</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="SubscriberClient-205"><a href="#SubscriberClient-205"><span class="linenos">205</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="SubscriberClient-206"><a href="#SubscriberClient-206"><span class="linenos">206</span></a>            <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="SubscriberClient-207"><a href="#SubscriberClient-207"><span class="linenos">207</span></a>                <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">next_query_params</span><span class="p">,</span>
</span><span id="SubscriberClient-208"><a href="#SubscriberClient-208"><span class="linenos">208</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
</span><span id="SubscriberClient-209"><a href="#SubscriberClient-209"><span class="linenos">209</span></a>            <span class="p">)</span>
</span><span id="SubscriberClient-210"><a href="#SubscriberClient-210"><span class="linenos">210</span></a>            <span class="n">page</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="SubscriberClient-211"><a href="#SubscriberClient-211"><span class="linenos">211</span></a>            <span class="n">all_results</span><span class="p">[</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">page</span><span class="p">[</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span>
</span><span id="SubscriberClient-212"><a href="#SubscriberClient-212"><span class="linenos">212</span></a>            <span class="n">nextPageToken</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nextPageToken&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="SubscriberClient-213"><a href="#SubscriberClient-213"><span class="linenos">213</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">nextPageToken</span><span class="p">:</span>
</span><span id="SubscriberClient-214"><a href="#SubscriberClient-214"><span class="linenos">214</span></a>                <span class="k">break</span>
</span><span id="SubscriberClient-215"><a href="#SubscriberClient-215"><span class="linenos">215</span></a>            <span class="n">next_query_params</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;pageToken&#39;</span><span class="p">:</span> <span class="n">nextPageToken</span><span class="p">})</span>
</span><span id="SubscriberClient-216"><a href="#SubscriberClient-216"><span class="linenos">216</span></a>
</span><span id="SubscriberClient-217"><a href="#SubscriberClient-217"><span class="linenos">217</span></a>        <span class="k">return</span> <span class="n">all_results</span>
</span><span id="SubscriberClient-218"><a href="#SubscriberClient-218"><span class="linenos">218</span></a>
</span><span id="SubscriberClient-219"><a href="#SubscriberClient-219"><span class="linenos">219</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberClient-220"><a href="#SubscriberClient-220"><span class="linenos">220</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SubscriberClient-221"><a href="#SubscriberClient-221"><span class="linenos">221</span></a>
</span><span id="SubscriberClient-222"><a href="#SubscriberClient-222"><span class="linenos">222</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;SubscriberClient&#39;</span><span class="p">:</span>
</span><span id="SubscriberClient-223"><a href="#SubscriberClient-223"><span class="linenos">223</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="SubscriberClient-224"><a href="#SubscriberClient-224"><span class="linenos">224</span></a>
</span><span id="SubscriberClient-225"><a href="#SubscriberClient-225"><span class="linenos">225</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberClient-226"><a href="#SubscriberClient-226"><span class="linenos">226</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


    

                            <div id="SubscriberClient.__init__" class="classattr">
                                        <input id="SubscriberClient.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SubscriberClient</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">service_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IO</span><span class="p">[</span><span class="o">~</span><span class="n">AnyStr</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gcloud</span><span class="o">.</span><span class="n">aio</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">api_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="SubscriberClient.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberClient.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberClient.__init__-45"><a href="#SubscriberClient.__init__-45"><span class="linenos">45</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SubscriberClient.__init__-46"><a href="#SubscriberClient.__init__-46"><span class="linenos">46</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">service_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IO</span><span class="p">[</span><span class="n">AnyStr</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient.__init__-47"><a href="#SubscriberClient.__init__-47"><span class="linenos">47</span></a>            <span class="n">token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient.__init__-48"><a href="#SubscriberClient.__init__-48"><span class="linenos">48</span></a>            <span class="n">api_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient.__init__-49"><a href="#SubscriberClient.__init__-49"><span class="linenos">49</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberClient.__init__-50"><a href="#SubscriberClient.__init__-50"><span class="linenos">50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_api_is_dev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span> <span class="o">=</span> <span class="n">init_api_root</span><span class="p">(</span><span class="n">api_root</span><span class="p">)</span>
</span><span id="SubscriberClient.__init__-51"><a href="#SubscriberClient.__init__-51"><span class="linenos">51</span></a>
</span><span id="SubscriberClient.__init__-52"><a href="#SubscriberClient.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">verify_ssl</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_is_dev</span><span class="p">)</span>
</span><span id="SubscriberClient.__init__-53"><a href="#SubscriberClient.__init__-53"><span class="linenos">53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span> <span class="ow">or</span> <span class="n">Token</span><span class="p">(</span>
</span><span id="SubscriberClient.__init__-54"><a href="#SubscriberClient.__init__-54"><span class="linenos">54</span></a>            <span class="n">service_file</span><span class="o">=</span><span class="n">service_file</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="n">SCOPES</span><span class="p">,</span>
</span><span id="SubscriberClient.__init__-55"><a href="#SubscriberClient.__init__-55"><span class="linenos">55</span></a>            <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="SubscriberClient.__init__-56"><a href="#SubscriberClient.__init__-56"><span class="linenos">56</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SubscriberClient.create_subscription" class="classattr">
                                        <input id="SubscriberClient.create_subscription-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">create_subscription</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">topic</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SubscriberClient.create_subscription-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberClient.create_subscription"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberClient.create_subscription-70"><a href="#SubscriberClient.create_subscription-70"><span class="linenos">70</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">create_subscription</span><span class="p">(</span>
</span><span id="SubscriberClient.create_subscription-71"><a href="#SubscriberClient.create_subscription-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SubscriberClient.create_subscription-72"><a href="#SubscriberClient.create_subscription-72"><span class="linenos">72</span></a>        <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SubscriberClient.create_subscription-73"><a href="#SubscriberClient.create_subscription-73"><span class="linenos">73</span></a>        <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SubscriberClient.create_subscription-74"><a href="#SubscriberClient.create_subscription-74"><span class="linenos">74</span></a>        <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient.create_subscription-75"><a href="#SubscriberClient.create_subscription-75"><span class="linenos">75</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="SubscriberClient.create_subscription-76"><a href="#SubscriberClient.create_subscription-76"><span class="linenos">76</span></a>        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient.create_subscription-77"><a href="#SubscriberClient.create_subscription-77"><span class="linenos">77</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SubscriberClient.create_subscription-78"><a href="#SubscriberClient.create_subscription-78"><span class="linenos">78</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SubscriberClient.create_subscription-79"><a href="#SubscriberClient.create_subscription-79"><span class="linenos">79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient.create_subscription-80"><a href="#SubscriberClient.create_subscription-80"><span class="linenos">80</span></a><span class="sd">        Create subscription.</span>
</span><span id="SubscriberClient.create_subscription-81"><a href="#SubscriberClient.create_subscription-81"><span class="linenos">81</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient.create_subscription-82"><a href="#SubscriberClient.create_subscription-82"><span class="linenos">82</span></a>        <span class="n">body</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">body</span> <span class="k">else</span> <span class="n">body</span>
</span><span id="SubscriberClient.create_subscription-83"><a href="#SubscriberClient.create_subscription-83"><span class="linenos">83</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="SubscriberClient.create_subscription-84"><a href="#SubscriberClient.create_subscription-84"><span class="linenos">84</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient.create_subscription-85"><a href="#SubscriberClient.create_subscription-85"><span class="linenos">85</span></a>        <span class="n">payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span id="SubscriberClient.create_subscription-86"><a href="#SubscriberClient.create_subscription-86"><span class="linenos">86</span></a>        <span class="n">payload</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="n">topic</span><span class="p">})</span>
</span><span id="SubscriberClient.create_subscription-87"><a href="#SubscriberClient.create_subscription-87"><span class="linenos">87</span></a>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="SubscriberClient.create_subscription-88"><a href="#SubscriberClient.create_subscription-88"><span class="linenos">88</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient.create_subscription-89"><a href="#SubscriberClient.create_subscription-89"><span class="linenos">89</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">encoded</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="SubscriberClient.create_subscription-90"><a href="#SubscriberClient.create_subscription-90"><span class="linenos">90</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="SubscriberClient.create_subscription-91"><a href="#SubscriberClient.create_subscription-91"><span class="linenos">91</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Create subscription.</p>
</div>


                            </div>
                            <div id="SubscriberClient.delete_subscription" class="classattr">
                                        <input id="SubscriberClient.delete_subscription-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">delete_subscription</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SubscriberClient.delete_subscription-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberClient.delete_subscription"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberClient.delete_subscription-94"><a href="#SubscriberClient.delete_subscription-94"><span class="linenos"> 94</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">delete_subscription</span><span class="p">(</span>
</span><span id="SubscriberClient.delete_subscription-95"><a href="#SubscriberClient.delete_subscription-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="SubscriberClient.delete_subscription-96"><a href="#SubscriberClient.delete_subscription-96"><span class="linenos"> 96</span></a>        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient.delete_subscription-97"><a href="#SubscriberClient.delete_subscription-97"><span class="linenos"> 97</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SubscriberClient.delete_subscription-98"><a href="#SubscriberClient.delete_subscription-98"><span class="linenos"> 98</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberClient.delete_subscription-99"><a href="#SubscriberClient.delete_subscription-99"><span class="linenos"> 99</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient.delete_subscription-100"><a href="#SubscriberClient.delete_subscription-100"><span class="linenos">100</span></a><span class="sd">        Delete subscription.</span>
</span><span id="SubscriberClient.delete_subscription-101"><a href="#SubscriberClient.delete_subscription-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient.delete_subscription-102"><a href="#SubscriberClient.delete_subscription-102"><span class="linenos">102</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="SubscriberClient.delete_subscription-103"><a href="#SubscriberClient.delete_subscription-103"><span class="linenos">103</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient.delete_subscription-104"><a href="#SubscriberClient.delete_subscription-104"><span class="linenos">104</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient.delete_subscription-105"><a href="#SubscriberClient.delete_subscription-105"><span class="linenos">105</span></a>        <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Delete subscription.</p>
</div>


                            </div>
                            <div id="SubscriberClient.pull" class="classattr">
                                        <input id="SubscriberClient.pull-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">pull</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">max_messages</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#SubscriberMessage">gcloud.aio.pubsub.SubscriberMessage</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SubscriberClient.pull-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberClient.pull"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberClient.pull-108"><a href="#SubscriberClient.pull-108"><span class="linenos">108</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span>
</span><span id="SubscriberClient.pull-109"><a href="#SubscriberClient.pull-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_messages</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="SubscriberClient.pull-110"><a href="#SubscriberClient.pull-110"><span class="linenos">110</span></a>        <span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient.pull-111"><a href="#SubscriberClient.pull-111"><span class="linenos">111</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>
</span><span id="SubscriberClient.pull-112"><a href="#SubscriberClient.pull-112"><span class="linenos">112</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SubscriberMessage</span><span class="p">]:</span>
</span><span id="SubscriberClient.pull-113"><a href="#SubscriberClient.pull-113"><span class="linenos">113</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient.pull-114"><a href="#SubscriberClient.pull-114"><span class="linenos">114</span></a><span class="sd">        Pull messages from subscription</span>
</span><span id="SubscriberClient.pull-115"><a href="#SubscriberClient.pull-115"><span class="linenos">115</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient.pull-116"><a href="#SubscriberClient.pull-116"><span class="linenos">116</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">:pull&#39;</span>
</span><span id="SubscriberClient.pull-117"><a href="#SubscriberClient.pull-117"><span class="linenos">117</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient.pull-118"><a href="#SubscriberClient.pull-118"><span class="linenos">118</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SubscriberClient.pull-119"><a href="#SubscriberClient.pull-119"><span class="linenos">119</span></a>            <span class="s1">&#39;maxMessages&#39;</span><span class="p">:</span> <span class="n">max_messages</span><span class="p">,</span>
</span><span id="SubscriberClient.pull-120"><a href="#SubscriberClient.pull-120"><span class="linenos">120</span></a>        <span class="p">}</span>
</span><span id="SubscriberClient.pull-121"><a href="#SubscriberClient.pull-121"><span class="linenos">121</span></a>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="SubscriberClient.pull-122"><a href="#SubscriberClient.pull-122"><span class="linenos">122</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient.pull-123"><a href="#SubscriberClient.pull-123"><span class="linenos">123</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="SubscriberClient.pull-124"><a href="#SubscriberClient.pull-124"><span class="linenos">124</span></a>            <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">encoded</span><span class="p">,</span>
</span><span id="SubscriberClient.pull-125"><a href="#SubscriberClient.pull-125"><span class="linenos">125</span></a>            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
</span><span id="SubscriberClient.pull-126"><a href="#SubscriberClient.pull-126"><span class="linenos">126</span></a>        <span class="p">)</span>
</span><span id="SubscriberClient.pull-127"><a href="#SubscriberClient.pull-127"><span class="linenos">127</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="SubscriberClient.pull-128"><a href="#SubscriberClient.pull-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="SubscriberClient.pull-129"><a href="#SubscriberClient.pull-129"><span class="linenos">129</span></a>            <span class="n">SubscriberMessage</span><span class="o">.</span><span class="n">from_repr</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="SubscriberClient.pull-130"><a href="#SubscriberClient.pull-130"><span class="linenos">130</span></a>            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;receivedMessages&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="SubscriberClient.pull-131"><a href="#SubscriberClient.pull-131"><span class="linenos">131</span></a>        <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Pull messages from subscription</p>
</div>


                            </div>
                            <div id="SubscriberClient.acknowledge" class="classattr">
                                        <input id="SubscriberClient.acknowledge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">acknowledge</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">ack_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SubscriberClient.acknowledge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberClient.acknowledge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberClient.acknowledge-134"><a href="#SubscriberClient.acknowledge-134"><span class="linenos">134</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">acknowledge</span><span class="p">(</span>
</span><span id="SubscriberClient.acknowledge-135"><a href="#SubscriberClient.acknowledge-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ack_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="SubscriberClient.acknowledge-136"><a href="#SubscriberClient.acknowledge-136"><span class="linenos">136</span></a>        <span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient.acknowledge-137"><a href="#SubscriberClient.acknowledge-137"><span class="linenos">137</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SubscriberClient.acknowledge-138"><a href="#SubscriberClient.acknowledge-138"><span class="linenos">138</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberClient.acknowledge-139"><a href="#SubscriberClient.acknowledge-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient.acknowledge-140"><a href="#SubscriberClient.acknowledge-140"><span class="linenos">140</span></a><span class="sd">        Acknowledge messages by ackIds</span>
</span><span id="SubscriberClient.acknowledge-141"><a href="#SubscriberClient.acknowledge-141"><span class="linenos">141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient.acknowledge-142"><a href="#SubscriberClient.acknowledge-142"><span class="linenos">142</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">:acknowledge&#39;</span>
</span><span id="SubscriberClient.acknowledge-143"><a href="#SubscriberClient.acknowledge-143"><span class="linenos">143</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient.acknowledge-144"><a href="#SubscriberClient.acknowledge-144"><span class="linenos">144</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SubscriberClient.acknowledge-145"><a href="#SubscriberClient.acknowledge-145"><span class="linenos">145</span></a>            <span class="s1">&#39;ackIds&#39;</span><span class="p">:</span> <span class="n">ack_ids</span><span class="p">,</span>
</span><span id="SubscriberClient.acknowledge-146"><a href="#SubscriberClient.acknowledge-146"><span class="linenos">146</span></a>        <span class="p">}</span>
</span><span id="SubscriberClient.acknowledge-147"><a href="#SubscriberClient.acknowledge-147"><span class="linenos">147</span></a>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="SubscriberClient.acknowledge-148"><a href="#SubscriberClient.acknowledge-148"><span class="linenos">148</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient.acknowledge-149"><a href="#SubscriberClient.acknowledge-149"><span class="linenos">149</span></a>        <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">encoded</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Acknowledge messages by ackIds</p>
</div>


                            </div>
                            <div id="SubscriberClient.modify_ack_deadline" class="classattr">
                                        <input id="SubscriberClient.modify_ack_deadline-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">modify_ack_deadline</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">ack_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">ack_deadline_seconds</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SubscriberClient.modify_ack_deadline-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberClient.modify_ack_deadline"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberClient.modify_ack_deadline-152"><a href="#SubscriberClient.modify_ack_deadline-152"><span class="linenos">152</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">modify_ack_deadline</span><span class="p">(</span>
</span><span id="SubscriberClient.modify_ack_deadline-153"><a href="#SubscriberClient.modify_ack_deadline-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SubscriberClient.modify_ack_deadline-154"><a href="#SubscriberClient.modify_ack_deadline-154"><span class="linenos">154</span></a>        <span class="n">ack_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="SubscriberClient.modify_ack_deadline-155"><a href="#SubscriberClient.modify_ack_deadline-155"><span class="linenos">155</span></a>        <span class="n">ack_deadline_seconds</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="SubscriberClient.modify_ack_deadline-156"><a href="#SubscriberClient.modify_ack_deadline-156"><span class="linenos">156</span></a>        <span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient.modify_ack_deadline-157"><a href="#SubscriberClient.modify_ack_deadline-157"><span class="linenos">157</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SubscriberClient.modify_ack_deadline-158"><a href="#SubscriberClient.modify_ack_deadline-158"><span class="linenos">158</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberClient.modify_ack_deadline-159"><a href="#SubscriberClient.modify_ack_deadline-159"><span class="linenos">159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient.modify_ack_deadline-160"><a href="#SubscriberClient.modify_ack_deadline-160"><span class="linenos">160</span></a><span class="sd">        Modify messages&#39; ack deadline.</span>
</span><span id="SubscriberClient.modify_ack_deadline-161"><a href="#SubscriberClient.modify_ack_deadline-161"><span class="linenos">161</span></a><span class="sd">        Set ack deadline to 0 to nack messages.</span>
</span><span id="SubscriberClient.modify_ack_deadline-162"><a href="#SubscriberClient.modify_ack_deadline-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient.modify_ack_deadline-163"><a href="#SubscriberClient.modify_ack_deadline-163"><span class="linenos">163</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">:modifyAckDeadline&#39;</span>
</span><span id="SubscriberClient.modify_ack_deadline-164"><a href="#SubscriberClient.modify_ack_deadline-164"><span class="linenos">164</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient.modify_ack_deadline-165"><a href="#SubscriberClient.modify_ack_deadline-165"><span class="linenos">165</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="SubscriberClient.modify_ack_deadline-166"><a href="#SubscriberClient.modify_ack_deadline-166"><span class="linenos">166</span></a>            <span class="s1">&#39;ackIds&#39;</span><span class="p">:</span> <span class="n">ack_ids</span><span class="p">,</span>
</span><span id="SubscriberClient.modify_ack_deadline-167"><a href="#SubscriberClient.modify_ack_deadline-167"><span class="linenos">167</span></a>            <span class="s1">&#39;ackDeadlineSeconds&#39;</span><span class="p">:</span> <span class="n">ack_deadline_seconds</span><span class="p">,</span>
</span><span id="SubscriberClient.modify_ack_deadline-168"><a href="#SubscriberClient.modify_ack_deadline-168"><span class="linenos">168</span></a>        <span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="SubscriberClient.modify_ack_deadline-169"><a href="#SubscriberClient.modify_ack_deadline-169"><span class="linenos">169</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient.modify_ack_deadline-170"><a href="#SubscriberClient.modify_ack_deadline-170"><span class="linenos">170</span></a>        <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Modify messages' ack deadline.
Set ack deadline to 0 to nack messages.</p>
</div>


                            </div>
                            <div id="SubscriberClient.get_subscription" class="classattr">
                                        <input id="SubscriberClient.get_subscription-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_subscription</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SubscriberClient.get_subscription-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberClient.get_subscription"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberClient.get_subscription-173"><a href="#SubscriberClient.get_subscription-173"><span class="linenos">173</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_subscription</span><span class="p">(</span>
</span><span id="SubscriberClient.get_subscription-174"><a href="#SubscriberClient.get_subscription-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SubscriberClient.get_subscription-175"><a href="#SubscriberClient.get_subscription-175"><span class="linenos">175</span></a>        <span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient.get_subscription-176"><a href="#SubscriberClient.get_subscription-176"><span class="linenos">176</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SubscriberClient.get_subscription-177"><a href="#SubscriberClient.get_subscription-177"><span class="linenos">177</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SubscriberClient.get_subscription-178"><a href="#SubscriberClient.get_subscription-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient.get_subscription-179"><a href="#SubscriberClient.get_subscription-179"><span class="linenos">179</span></a><span class="sd">        Get Subscription</span>
</span><span id="SubscriberClient.get_subscription-180"><a href="#SubscriberClient.get_subscription-180"><span class="linenos">180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient.get_subscription-181"><a href="#SubscriberClient.get_subscription-181"><span class="linenos">181</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">subscription</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="SubscriberClient.get_subscription-182"><a href="#SubscriberClient.get_subscription-182"><span class="linenos">182</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient.get_subscription-183"><a href="#SubscriberClient.get_subscription-183"><span class="linenos">183</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient.get_subscription-184"><a href="#SubscriberClient.get_subscription-184"><span class="linenos">184</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="SubscriberClient.get_subscription-185"><a href="#SubscriberClient.get_subscription-185"><span class="linenos">185</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="SubscriberClient.get_subscription-186"><a href="#SubscriberClient.get_subscription-186"><span class="linenos">186</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Get Subscription</p>
</div>


                            </div>
                            <div id="SubscriberClient.list_subscriptions" class="classattr">
                                        <input id="SubscriberClient.list_subscriptions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">list_subscriptions</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">project</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">query_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SubscriberClient.list_subscriptions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberClient.list_subscriptions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberClient.list_subscriptions-189"><a href="#SubscriberClient.list_subscriptions-189"><span class="linenos">189</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">list_subscriptions</span><span class="p">(</span>
</span><span id="SubscriberClient.list_subscriptions-190"><a href="#SubscriberClient.list_subscriptions-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SubscriberClient.list_subscriptions-191"><a href="#SubscriberClient.list_subscriptions-191"><span class="linenos">191</span></a>        <span class="n">query_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient.list_subscriptions-192"><a href="#SubscriberClient.list_subscriptions-192"><span class="linenos">192</span></a>        <span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberClient.list_subscriptions-193"><a href="#SubscriberClient.list_subscriptions-193"><span class="linenos">193</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="SubscriberClient.list_subscriptions-194"><a href="#SubscriberClient.list_subscriptions-194"><span class="linenos">194</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SubscriberClient.list_subscriptions-195"><a href="#SubscriberClient.list_subscriptions-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SubscriberClient.list_subscriptions-196"><a href="#SubscriberClient.list_subscriptions-196"><span class="linenos">196</span></a><span class="sd">        List subscriptions</span>
</span><span id="SubscriberClient.list_subscriptions-197"><a href="#SubscriberClient.list_subscriptions-197"><span class="linenos">197</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SubscriberClient.list_subscriptions-198"><a href="#SubscriberClient.list_subscriptions-198"><span class="linenos">198</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_root</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">project</span><span class="si">}</span><span class="s1">/subscriptions&#39;</span>
</span><span id="SubscriberClient.list_subscriptions-199"><a href="#SubscriberClient.list_subscriptions-199"><span class="linenos">199</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">()</span>
</span><span id="SubscriberClient.list_subscriptions-200"><a href="#SubscriberClient.list_subscriptions-200"><span class="linenos">200</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">AioSession</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
</span><span id="SubscriberClient.list_subscriptions-201"><a href="#SubscriberClient.list_subscriptions-201"><span class="linenos">201</span></a>
</span><span id="SubscriberClient.list_subscriptions-202"><a href="#SubscriberClient.list_subscriptions-202"><span class="linenos">202</span></a>        <span class="n">all_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">:</span> <span class="p">[]}</span>
</span><span id="SubscriberClient.list_subscriptions-203"><a href="#SubscriberClient.list_subscriptions-203"><span class="linenos">203</span></a>        <span class="n">nextPageToken</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SubscriberClient.list_subscriptions-204"><a href="#SubscriberClient.list_subscriptions-204"><span class="linenos">204</span></a>        <span class="n">next_query_params</span> <span class="o">=</span> <span class="n">query_params</span> <span class="k">if</span> <span class="n">query_params</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="SubscriberClient.list_subscriptions-205"><a href="#SubscriberClient.list_subscriptions-205"><span class="linenos">205</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="SubscriberClient.list_subscriptions-206"><a href="#SubscriberClient.list_subscriptions-206"><span class="linenos">206</span></a>            <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="SubscriberClient.list_subscriptions-207"><a href="#SubscriberClient.list_subscriptions-207"><span class="linenos">207</span></a>                <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">next_query_params</span><span class="p">,</span>
</span><span id="SubscriberClient.list_subscriptions-208"><a href="#SubscriberClient.list_subscriptions-208"><span class="linenos">208</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
</span><span id="SubscriberClient.list_subscriptions-209"><a href="#SubscriberClient.list_subscriptions-209"><span class="linenos">209</span></a>            <span class="p">)</span>
</span><span id="SubscriberClient.list_subscriptions-210"><a href="#SubscriberClient.list_subscriptions-210"><span class="linenos">210</span></a>            <span class="n">page</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="SubscriberClient.list_subscriptions-211"><a href="#SubscriberClient.list_subscriptions-211"><span class="linenos">211</span></a>            <span class="n">all_results</span><span class="p">[</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">page</span><span class="p">[</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span>
</span><span id="SubscriberClient.list_subscriptions-212"><a href="#SubscriberClient.list_subscriptions-212"><span class="linenos">212</span></a>            <span class="n">nextPageToken</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nextPageToken&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="SubscriberClient.list_subscriptions-213"><a href="#SubscriberClient.list_subscriptions-213"><span class="linenos">213</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">nextPageToken</span><span class="p">:</span>
</span><span id="SubscriberClient.list_subscriptions-214"><a href="#SubscriberClient.list_subscriptions-214"><span class="linenos">214</span></a>                <span class="k">break</span>
</span><span id="SubscriberClient.list_subscriptions-215"><a href="#SubscriberClient.list_subscriptions-215"><span class="linenos">215</span></a>            <span class="n">next_query_params</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;pageToken&#39;</span><span class="p">:</span> <span class="n">nextPageToken</span><span class="p">})</span>
</span><span id="SubscriberClient.list_subscriptions-216"><a href="#SubscriberClient.list_subscriptions-216"><span class="linenos">216</span></a>
</span><span id="SubscriberClient.list_subscriptions-217"><a href="#SubscriberClient.list_subscriptions-217"><span class="linenos">217</span></a>        <span class="k">return</span> <span class="n">all_results</span>
</span></pre></div>


            <div class="docstring"><p>List subscriptions</p>
</div>


                            </div>
                            <div id="SubscriberClient.close" class="classattr">
                                        <input id="SubscriberClient.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SubscriberClient.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberClient.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberClient.close-219"><a href="#SubscriberClient.close-219"><span class="linenos">219</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberClient.close-220"><a href="#SubscriberClient.close-220"><span class="linenos">220</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="SubscriberMessage">
                            <input id="SubscriberMessage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SubscriberMessage</span>:

                <label class="view-source-button" for="SubscriberMessage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberMessage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberMessage-20"><a href="#SubscriberMessage-20"><span class="linenos">20</span></a><span class="k">class</span> <span class="nc">SubscriberMessage</span><span class="p">:</span>
</span><span id="SubscriberMessage-21"><a href="#SubscriberMessage-21"><span class="linenos">21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SubscriberMessage-22"><a href="#SubscriberMessage-22"><span class="linenos">22</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ack_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SubscriberMessage-23"><a href="#SubscriberMessage-23"><span class="linenos">23</span></a>        <span class="n">publish_time</span><span class="p">:</span> <span class="s1">&#39;datetime.datetime&#39;</span><span class="p">,</span>
</span><span id="SubscriberMessage-24"><a href="#SubscriberMessage-24"><span class="linenos">24</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">],</span>
</span><span id="SubscriberMessage-25"><a href="#SubscriberMessage-25"><span class="linenos">25</span></a>        <span class="n">attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="SubscriberMessage-26"><a href="#SubscriberMessage-26"><span class="linenos">26</span></a>        <span class="n">delivery_attempt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberMessage-27"><a href="#SubscriberMessage-27"><span class="linenos">27</span></a>    <span class="p">):</span>
</span><span id="SubscriberMessage-28"><a href="#SubscriberMessage-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ack_id</span> <span class="o">=</span> <span class="n">ack_id</span>
</span><span id="SubscriberMessage-29"><a href="#SubscriberMessage-29"><span class="linenos">29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">message_id</span> <span class="o">=</span> <span class="n">message_id</span>
</span><span id="SubscriberMessage-30"><a href="#SubscriberMessage-30"><span class="linenos">30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publish_time</span> <span class="o">=</span> <span class="n">publish_time</span>
</span><span id="SubscriberMessage-31"><a href="#SubscriberMessage-31"><span class="linenos">31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="SubscriberMessage-32"><a href="#SubscriberMessage-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span>
</span><span id="SubscriberMessage-33"><a href="#SubscriberMessage-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delivery_attempt</span> <span class="o">=</span> <span class="n">delivery_attempt</span>
</span><span id="SubscriberMessage-34"><a href="#SubscriberMessage-34"><span class="linenos">34</span></a>
</span><span id="SubscriberMessage-35"><a href="#SubscriberMessage-35"><span class="linenos">35</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SubscriberMessage-36"><a href="#SubscriberMessage-36"><span class="linenos">36</span></a>    <span class="k">def</span> <span class="nf">from_repr</span><span class="p">(</span>
</span><span id="SubscriberMessage-37"><a href="#SubscriberMessage-37"><span class="linenos">37</span></a>        <span class="n">received_message</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="SubscriberMessage-38"><a href="#SubscriberMessage-38"><span class="linenos">38</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;SubscriberMessage&#39;</span><span class="p">:</span>
</span><span id="SubscriberMessage-39"><a href="#SubscriberMessage-39"><span class="linenos">39</span></a>        <span class="n">ack_id</span> <span class="o">=</span> <span class="n">received_message</span><span class="p">[</span><span class="s1">&#39;ackId&#39;</span><span class="p">]</span>
</span><span id="SubscriberMessage-40"><a href="#SubscriberMessage-40"><span class="linenos">40</span></a>        <span class="n">message_id</span> <span class="o">=</span> <span class="n">received_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;messageId&#39;</span><span class="p">]</span>
</span><span id="SubscriberMessage-41"><a href="#SubscriberMessage-41"><span class="linenos">41</span></a>        <span class="n">raw_data</span> <span class="o">=</span> <span class="n">received_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span><span id="SubscriberMessage-42"><a href="#SubscriberMessage-42"><span class="linenos">42</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span> <span class="k">if</span> <span class="n">raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="SubscriberMessage-43"><a href="#SubscriberMessage-43"><span class="linenos">43</span></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="n">received_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;attributes&#39;</span><span class="p">)</span>
</span><span id="SubscriberMessage-44"><a href="#SubscriberMessage-44"><span class="linenos">44</span></a>        <span class="n">publish_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">parse_publish_time</span><span class="p">(</span>
</span><span id="SubscriberMessage-45"><a href="#SubscriberMessage-45"><span class="linenos">45</span></a>            <span class="n">received_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;publishTime&#39;</span><span class="p">],</span>
</span><span id="SubscriberMessage-46"><a href="#SubscriberMessage-46"><span class="linenos">46</span></a>        <span class="p">)</span>
</span><span id="SubscriberMessage-47"><a href="#SubscriberMessage-47"><span class="linenos">47</span></a>        <span class="n">delivery_attempt</span> <span class="o">=</span> <span class="n">received_message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deliveryAttempt&#39;</span><span class="p">)</span>
</span><span id="SubscriberMessage-48"><a href="#SubscriberMessage-48"><span class="linenos">48</span></a>        <span class="k">return</span> <span class="n">SubscriberMessage</span><span class="p">(</span>
</span><span id="SubscriberMessage-49"><a href="#SubscriberMessage-49"><span class="linenos">49</span></a>            <span class="n">ack_id</span><span class="o">=</span><span class="n">ack_id</span><span class="p">,</span> <span class="n">message_id</span><span class="o">=</span><span class="n">message_id</span><span class="p">,</span>
</span><span id="SubscriberMessage-50"><a href="#SubscriberMessage-50"><span class="linenos">50</span></a>            <span class="n">publish_time</span><span class="o">=</span><span class="n">publish_time</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
</span><span id="SubscriberMessage-51"><a href="#SubscriberMessage-51"><span class="linenos">51</span></a>            <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">,</span>
</span><span id="SubscriberMessage-52"><a href="#SubscriberMessage-52"><span class="linenos">52</span></a>            <span class="n">delivery_attempt</span><span class="o">=</span><span class="n">delivery_attempt</span><span class="p">,</span>
</span><span id="SubscriberMessage-53"><a href="#SubscriberMessage-53"><span class="linenos">53</span></a>        <span class="p">)</span>
</span><span id="SubscriberMessage-54"><a href="#SubscriberMessage-54"><span class="linenos">54</span></a>
</span><span id="SubscriberMessage-55"><a href="#SubscriberMessage-55"><span class="linenos">55</span></a>    <span class="k">def</span> <span class="nf">to_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SubscriberMessage-56"><a href="#SubscriberMessage-56"><span class="linenos">56</span></a>        <span class="n">r</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SubscriberMessage-57"><a href="#SubscriberMessage-57"><span class="linenos">57</span></a>            <span class="s1">&#39;ackId&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ack_id</span><span class="p">,</span>
</span><span id="SubscriberMessage-58"><a href="#SubscriberMessage-58"><span class="linenos">58</span></a>            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SubscriberMessage-59"><a href="#SubscriberMessage-59"><span class="linenos">59</span></a>                <span class="s1">&#39;messageId&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_id</span><span class="p">,</span>
</span><span id="SubscriberMessage-60"><a href="#SubscriberMessage-60"><span class="linenos">60</span></a>                <span class="s1">&#39;publishTime&#39;</span><span class="p">:</span> <span class="p">(</span>
</span><span id="SubscriberMessage-61"><a href="#SubscriberMessage-61"><span class="linenos">61</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">publish_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%SZ&#39;</span><span class="p">)</span>
</span><span id="SubscriberMessage-62"><a href="#SubscriberMessage-62"><span class="linenos">62</span></a>                <span class="p">),</span>
</span><span id="SubscriberMessage-63"><a href="#SubscriberMessage-63"><span class="linenos">63</span></a>            <span class="p">},</span>
</span><span id="SubscriberMessage-64"><a href="#SubscriberMessage-64"><span class="linenos">64</span></a>        <span class="p">}</span>
</span><span id="SubscriberMessage-65"><a href="#SubscriberMessage-65"><span class="linenos">65</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberMessage-66"><a href="#SubscriberMessage-66"><span class="linenos">66</span></a>            <span class="n">r</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span>
</span><span id="SubscriberMessage-67"><a href="#SubscriberMessage-67"><span class="linenos">67</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberMessage-68"><a href="#SubscriberMessage-68"><span class="linenos">68</span></a>            <span class="n">r</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="SubscriberMessage-69"><a href="#SubscriberMessage-69"><span class="linenos">69</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delivery_attempt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberMessage-70"><a href="#SubscriberMessage-70"><span class="linenos">70</span></a>            <span class="n">r</span><span class="p">[</span><span class="s1">&#39;deliveryAttempt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delivery_attempt</span>
</span><span id="SubscriberMessage-71"><a href="#SubscriberMessage-71"><span class="linenos">71</span></a>        <span class="k">return</span> <span class="n">r</span>
</span></pre></div>


    

                            <div id="SubscriberMessage.__init__" class="classattr">
                                        <input id="SubscriberMessage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SubscriberMessage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">ack_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">publish_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span>,</span><span class="param">	<span class="n">attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>,</span><span class="param">	<span class="n">delivery_attempt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="SubscriberMessage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberMessage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberMessage.__init__-21"><a href="#SubscriberMessage.__init__-21"><span class="linenos">21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SubscriberMessage.__init__-22"><a href="#SubscriberMessage.__init__-22"><span class="linenos">22</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ack_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SubscriberMessage.__init__-23"><a href="#SubscriberMessage.__init__-23"><span class="linenos">23</span></a>        <span class="n">publish_time</span><span class="p">:</span> <span class="s1">&#39;datetime.datetime&#39;</span><span class="p">,</span>
</span><span id="SubscriberMessage.__init__-24"><a href="#SubscriberMessage.__init__-24"><span class="linenos">24</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">],</span>
</span><span id="SubscriberMessage.__init__-25"><a href="#SubscriberMessage.__init__-25"><span class="linenos">25</span></a>        <span class="n">attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="SubscriberMessage.__init__-26"><a href="#SubscriberMessage.__init__-26"><span class="linenos">26</span></a>        <span class="n">delivery_attempt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SubscriberMessage.__init__-27"><a href="#SubscriberMessage.__init__-27"><span class="linenos">27</span></a>    <span class="p">):</span>
</span><span id="SubscriberMessage.__init__-28"><a href="#SubscriberMessage.__init__-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ack_id</span> <span class="o">=</span> <span class="n">ack_id</span>
</span><span id="SubscriberMessage.__init__-29"><a href="#SubscriberMessage.__init__-29"><span class="linenos">29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">message_id</span> <span class="o">=</span> <span class="n">message_id</span>
</span><span id="SubscriberMessage.__init__-30"><a href="#SubscriberMessage.__init__-30"><span class="linenos">30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publish_time</span> <span class="o">=</span> <span class="n">publish_time</span>
</span><span id="SubscriberMessage.__init__-31"><a href="#SubscriberMessage.__init__-31"><span class="linenos">31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="SubscriberMessage.__init__-32"><a href="#SubscriberMessage.__init__-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span>
</span><span id="SubscriberMessage.__init__-33"><a href="#SubscriberMessage.__init__-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delivery_attempt</span> <span class="o">=</span> <span class="n">delivery_attempt</span>
</span></pre></div>


    

                            </div>
                            <div id="SubscriberMessage.from_repr" class="classattr">
                                        <input id="SubscriberMessage.from_repr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">from_repr</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">received_message</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#SubscriberMessage">gcloud.aio.pubsub.SubscriberMessage</a></span>:</span></span>

                <label class="view-source-button" for="SubscriberMessage.from_repr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberMessage.from_repr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberMessage.from_repr-35"><a href="#SubscriberMessage.from_repr-35"><span class="linenos">35</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SubscriberMessage.from_repr-36"><a href="#SubscriberMessage.from_repr-36"><span class="linenos">36</span></a>    <span class="k">def</span> <span class="nf">from_repr</span><span class="p">(</span>
</span><span id="SubscriberMessage.from_repr-37"><a href="#SubscriberMessage.from_repr-37"><span class="linenos">37</span></a>        <span class="n">received_message</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="SubscriberMessage.from_repr-38"><a href="#SubscriberMessage.from_repr-38"><span class="linenos">38</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;SubscriberMessage&#39;</span><span class="p">:</span>
</span><span id="SubscriberMessage.from_repr-39"><a href="#SubscriberMessage.from_repr-39"><span class="linenos">39</span></a>        <span class="n">ack_id</span> <span class="o">=</span> <span class="n">received_message</span><span class="p">[</span><span class="s1">&#39;ackId&#39;</span><span class="p">]</span>
</span><span id="SubscriberMessage.from_repr-40"><a href="#SubscriberMessage.from_repr-40"><span class="linenos">40</span></a>        <span class="n">message_id</span> <span class="o">=</span> <span class="n">received_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;messageId&#39;</span><span class="p">]</span>
</span><span id="SubscriberMessage.from_repr-41"><a href="#SubscriberMessage.from_repr-41"><span class="linenos">41</span></a>        <span class="n">raw_data</span> <span class="o">=</span> <span class="n">received_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span><span id="SubscriberMessage.from_repr-42"><a href="#SubscriberMessage.from_repr-42"><span class="linenos">42</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span> <span class="k">if</span> <span class="n">raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="SubscriberMessage.from_repr-43"><a href="#SubscriberMessage.from_repr-43"><span class="linenos">43</span></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="n">received_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;attributes&#39;</span><span class="p">)</span>
</span><span id="SubscriberMessage.from_repr-44"><a href="#SubscriberMessage.from_repr-44"><span class="linenos">44</span></a>        <span class="n">publish_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">parse_publish_time</span><span class="p">(</span>
</span><span id="SubscriberMessage.from_repr-45"><a href="#SubscriberMessage.from_repr-45"><span class="linenos">45</span></a>            <span class="n">received_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;publishTime&#39;</span><span class="p">],</span>
</span><span id="SubscriberMessage.from_repr-46"><a href="#SubscriberMessage.from_repr-46"><span class="linenos">46</span></a>        <span class="p">)</span>
</span><span id="SubscriberMessage.from_repr-47"><a href="#SubscriberMessage.from_repr-47"><span class="linenos">47</span></a>        <span class="n">delivery_attempt</span> <span class="o">=</span> <span class="n">received_message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deliveryAttempt&#39;</span><span class="p">)</span>
</span><span id="SubscriberMessage.from_repr-48"><a href="#SubscriberMessage.from_repr-48"><span class="linenos">48</span></a>        <span class="k">return</span> <span class="n">SubscriberMessage</span><span class="p">(</span>
</span><span id="SubscriberMessage.from_repr-49"><a href="#SubscriberMessage.from_repr-49"><span class="linenos">49</span></a>            <span class="n">ack_id</span><span class="o">=</span><span class="n">ack_id</span><span class="p">,</span> <span class="n">message_id</span><span class="o">=</span><span class="n">message_id</span><span class="p">,</span>
</span><span id="SubscriberMessage.from_repr-50"><a href="#SubscriberMessage.from_repr-50"><span class="linenos">50</span></a>            <span class="n">publish_time</span><span class="o">=</span><span class="n">publish_time</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
</span><span id="SubscriberMessage.from_repr-51"><a href="#SubscriberMessage.from_repr-51"><span class="linenos">51</span></a>            <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">,</span>
</span><span id="SubscriberMessage.from_repr-52"><a href="#SubscriberMessage.from_repr-52"><span class="linenos">52</span></a>            <span class="n">delivery_attempt</span><span class="o">=</span><span class="n">delivery_attempt</span><span class="p">,</span>
</span><span id="SubscriberMessage.from_repr-53"><a href="#SubscriberMessage.from_repr-53"><span class="linenos">53</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SubscriberMessage.to_repr" class="classattr">
                                        <input id="SubscriberMessage.to_repr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_repr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SubscriberMessage.to_repr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SubscriberMessage.to_repr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SubscriberMessage.to_repr-55"><a href="#SubscriberMessage.to_repr-55"><span class="linenos">55</span></a>    <span class="k">def</span> <span class="nf">to_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SubscriberMessage.to_repr-56"><a href="#SubscriberMessage.to_repr-56"><span class="linenos">56</span></a>        <span class="n">r</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SubscriberMessage.to_repr-57"><a href="#SubscriberMessage.to_repr-57"><span class="linenos">57</span></a>            <span class="s1">&#39;ackId&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ack_id</span><span class="p">,</span>
</span><span id="SubscriberMessage.to_repr-58"><a href="#SubscriberMessage.to_repr-58"><span class="linenos">58</span></a>            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SubscriberMessage.to_repr-59"><a href="#SubscriberMessage.to_repr-59"><span class="linenos">59</span></a>                <span class="s1">&#39;messageId&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_id</span><span class="p">,</span>
</span><span id="SubscriberMessage.to_repr-60"><a href="#SubscriberMessage.to_repr-60"><span class="linenos">60</span></a>                <span class="s1">&#39;publishTime&#39;</span><span class="p">:</span> <span class="p">(</span>
</span><span id="SubscriberMessage.to_repr-61"><a href="#SubscriberMessage.to_repr-61"><span class="linenos">61</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">publish_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%SZ&#39;</span><span class="p">)</span>
</span><span id="SubscriberMessage.to_repr-62"><a href="#SubscriberMessage.to_repr-62"><span class="linenos">62</span></a>                <span class="p">),</span>
</span><span id="SubscriberMessage.to_repr-63"><a href="#SubscriberMessage.to_repr-63"><span class="linenos">63</span></a>            <span class="p">},</span>
</span><span id="SubscriberMessage.to_repr-64"><a href="#SubscriberMessage.to_repr-64"><span class="linenos">64</span></a>        <span class="p">}</span>
</span><span id="SubscriberMessage.to_repr-65"><a href="#SubscriberMessage.to_repr-65"><span class="linenos">65</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberMessage.to_repr-66"><a href="#SubscriberMessage.to_repr-66"><span class="linenos">66</span></a>            <span class="n">r</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span>
</span><span id="SubscriberMessage.to_repr-67"><a href="#SubscriberMessage.to_repr-67"><span class="linenos">67</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberMessage.to_repr-68"><a href="#SubscriberMessage.to_repr-68"><span class="linenos">68</span></a>            <span class="n">r</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="SubscriberMessage.to_repr-69"><a href="#SubscriberMessage.to_repr-69"><span class="linenos">69</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delivery_attempt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SubscriberMessage.to_repr-70"><a href="#SubscriberMessage.to_repr-70"><span class="linenos">70</span></a>            <span class="n">r</span><span class="p">[</span><span class="s1">&#39;deliveryAttempt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delivery_attempt</span>
</span><span id="SubscriberMessage.to_repr-71"><a href="#SubscriberMessage.to_repr-71"><span class="linenos">71</span></a>        <span class="k">return</span> <span class="n">r</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="__version__">
                    <div class="attr variable">
            <span class="name">__version__</span><span class="default_value"> = &#39;5.2.0&#39;</span>

        
    </div>
    <a class="headerlink" href="#__version__"></a>
    
    

                </section>
                <section id="subscribe">
                            <input id="subscribe-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">subscribe</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n"><a href="#SubscriberMessage">gcloud.aio.pubsub.SubscriberMessage</a></span><span class="p">],</span> <span class="n">Awaitable</span><span class="p">[</span><span class="n">NoneType</span><span class="p">]]</span>,</span><span class="param">	<span class="n">subscriber_client</span><span class="p">:</span> <span class="n"><a href="#SubscriberClient">gcloud.aio.pubsub.SubscriberClient</a></span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">num_producers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">max_messages_per_producer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>,</span><span class="param">	<span class="n">ack_window</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span>,</span><span class="param">	<span class="n">ack_deadline_cache_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">inf</span>,</span><span class="param">	<span class="n">num_tasks_per_consumer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">enable_nack</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">nack_window</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span>,</span><span class="param">	<span class="n">metrics_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gcloud</span><span class="o">.</span><span class="n">aio</span><span class="o">.</span><span class="n">pubsub</span><span class="o">.</span><span class="n">metrics_agent</span><span class="o">.</span><span class="n">MetricsAgent</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="subscribe-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#subscribe"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="subscribe-439"><a href="#subscribe-439"><span class="linenos">439</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span>
</span><span id="subscribe-440"><a href="#subscribe-440"><span class="linenos">440</span></a>        <span class="n">subscription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="subscribe-441"><a href="#subscribe-441"><span class="linenos">441</span></a>        <span class="n">handler</span><span class="p">:</span> <span class="n">ApplicationHandler</span><span class="p">,</span>
</span><span id="subscribe-442"><a href="#subscribe-442"><span class="linenos">442</span></a>        <span class="n">subscriber_client</span><span class="p">:</span> <span class="n">SubscriberClient</span><span class="p">,</span>
</span><span id="subscribe-443"><a href="#subscribe-443"><span class="linenos">443</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="subscribe-444"><a href="#subscribe-444"><span class="linenos">444</span></a>        <span class="n">num_producers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="subscribe-445"><a href="#subscribe-445"><span class="linenos">445</span></a>        <span class="n">max_messages_per_producer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="subscribe-446"><a href="#subscribe-446"><span class="linenos">446</span></a>        <span class="n">ack_window</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="subscribe-447"><a href="#subscribe-447"><span class="linenos">447</span></a>        <span class="n">ack_deadline_cache_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span>
</span><span id="subscribe-448"><a href="#subscribe-448"><span class="linenos">448</span></a>        <span class="n">num_tasks_per_consumer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="subscribe-449"><a href="#subscribe-449"><span class="linenos">449</span></a>        <span class="n">enable_nack</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="subscribe-450"><a href="#subscribe-450"><span class="linenos">450</span></a>        <span class="n">nack_window</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="subscribe-451"><a href="#subscribe-451"><span class="linenos">451</span></a>        <span class="n">metrics_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MetricsAgent</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="subscribe-452"><a href="#subscribe-452"><span class="linenos">452</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="subscribe-453"><a href="#subscribe-453"><span class="linenos">453</span></a>        <span class="c1"># pylint: disable=too-many-locals</span>
</span><span id="subscribe-454"><a href="#subscribe-454"><span class="linenos">454</span></a>        <span class="n">ack_queue</span><span class="p">:</span> <span class="s1">&#39;asyncio.Queue[str]&#39;</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span>
</span><span id="subscribe-455"><a href="#subscribe-455"><span class="linenos">455</span></a>            <span class="n">maxsize</span><span class="o">=</span><span class="p">(</span><span class="n">max_messages_per_producer</span> <span class="o">*</span> <span class="n">num_producers</span><span class="p">),</span>
</span><span id="subscribe-456"><a href="#subscribe-456"><span class="linenos">456</span></a>        <span class="p">)</span>
</span><span id="subscribe-457"><a href="#subscribe-457"><span class="linenos">457</span></a>        <span class="n">nack_queue</span><span class="p">:</span> <span class="s1">&#39;Optional[asyncio.Queue[str]]&#39;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="subscribe-458"><a href="#subscribe-458"><span class="linenos">458</span></a>        <span class="n">ack_deadline_cache</span> <span class="o">=</span> <span class="n">AckDeadlineCache</span><span class="p">(</span>
</span><span id="subscribe-459"><a href="#subscribe-459"><span class="linenos">459</span></a>            <span class="n">subscriber_client</span><span class="p">,</span>
</span><span id="subscribe-460"><a href="#subscribe-460"><span class="linenos">460</span></a>            <span class="n">subscription</span><span class="p">,</span>
</span><span id="subscribe-461"><a href="#subscribe-461"><span class="linenos">461</span></a>            <span class="n">ack_deadline_cache_timeout</span><span class="p">,</span>
</span><span id="subscribe-462"><a href="#subscribe-462"><span class="linenos">462</span></a>        <span class="p">)</span>
</span><span id="subscribe-463"><a href="#subscribe-463"><span class="linenos">463</span></a>
</span><span id="subscribe-464"><a href="#subscribe-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="n">metrics_client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="subscribe-465"><a href="#subscribe-465"><span class="linenos">465</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="subscribe-466"><a href="#subscribe-466"><span class="linenos">466</span></a>                <span class="s1">&#39;Using MetricsAgent in subscribe() is deprecated. &#39;</span>
</span><span id="subscribe-467"><a href="#subscribe-467"><span class="linenos">467</span></a>                <span class="s1">&#39;Refer to Prometheus metrics instead.&#39;</span><span class="p">,</span>
</span><span id="subscribe-468"><a href="#subscribe-468"><span class="linenos">468</span></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="subscribe-469"><a href="#subscribe-469"><span class="linenos">469</span></a>            <span class="p">)</span>
</span><span id="subscribe-470"><a href="#subscribe-470"><span class="linenos">470</span></a>        <span class="n">metrics_client</span> <span class="o">=</span> <span class="n">metrics_client</span> <span class="ow">or</span> <span class="n">MetricsAgent</span><span class="p">()</span>
</span><span id="subscribe-471"><a href="#subscribe-471"><span class="linenos">471</span></a>        <span class="n">acker_tasks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="subscribe-472"><a href="#subscribe-472"><span class="linenos">472</span></a>        <span class="n">consumer_tasks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="subscribe-473"><a href="#subscribe-473"><span class="linenos">473</span></a>        <span class="n">producer_tasks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="subscribe-474"><a href="#subscribe-474"><span class="linenos">474</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="subscribe-475"><a href="#subscribe-475"><span class="linenos">475</span></a>            <span class="n">acker_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="subscribe-476"><a href="#subscribe-476"><span class="linenos">476</span></a>                <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span>
</span><span id="subscribe-477"><a href="#subscribe-477"><span class="linenos">477</span></a>                    <span class="n">acker</span><span class="p">(</span>
</span><span id="subscribe-478"><a href="#subscribe-478"><span class="linenos">478</span></a>                        <span class="n">subscription</span><span class="p">,</span> <span class="n">ack_queue</span><span class="p">,</span> <span class="n">subscriber_client</span><span class="p">,</span>
</span><span id="subscribe-479"><a href="#subscribe-479"><span class="linenos">479</span></a>                        <span class="n">ack_window</span><span class="o">=</span><span class="n">ack_window</span><span class="p">,</span> <span class="n">metrics_client</span><span class="o">=</span><span class="n">metrics_client</span><span class="p">,</span>
</span><span id="subscribe-480"><a href="#subscribe-480"><span class="linenos">480</span></a>                    <span class="p">),</span>
</span><span id="subscribe-481"><a href="#subscribe-481"><span class="linenos">481</span></a>                <span class="p">),</span>
</span><span id="subscribe-482"><a href="#subscribe-482"><span class="linenos">482</span></a>            <span class="p">)</span>
</span><span id="subscribe-483"><a href="#subscribe-483"><span class="linenos">483</span></a>            <span class="k">if</span> <span class="n">enable_nack</span><span class="p">:</span>
</span><span id="subscribe-484"><a href="#subscribe-484"><span class="linenos">484</span></a>                <span class="n">nack_queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span>
</span><span id="subscribe-485"><a href="#subscribe-485"><span class="linenos">485</span></a>                    <span class="n">maxsize</span><span class="o">=</span><span class="p">(</span><span class="n">max_messages_per_producer</span> <span class="o">*</span> <span class="n">num_producers</span><span class="p">),</span>
</span><span id="subscribe-486"><a href="#subscribe-486"><span class="linenos">486</span></a>                <span class="p">)</span>
</span><span id="subscribe-487"><a href="#subscribe-487"><span class="linenos">487</span></a>                <span class="n">acker_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="subscribe-488"><a href="#subscribe-488"><span class="linenos">488</span></a>                    <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span>
</span><span id="subscribe-489"><a href="#subscribe-489"><span class="linenos">489</span></a>                        <span class="n">nacker</span><span class="p">(</span>
</span><span id="subscribe-490"><a href="#subscribe-490"><span class="linenos">490</span></a>                            <span class="n">subscription</span><span class="p">,</span> <span class="n">nack_queue</span><span class="p">,</span> <span class="n">subscriber_client</span><span class="p">,</span>
</span><span id="subscribe-491"><a href="#subscribe-491"><span class="linenos">491</span></a>                            <span class="n">nack_window</span><span class="o">=</span><span class="n">nack_window</span><span class="p">,</span>
</span><span id="subscribe-492"><a href="#subscribe-492"><span class="linenos">492</span></a>                            <span class="n">metrics_client</span><span class="o">=</span><span class="n">metrics_client</span><span class="p">,</span>
</span><span id="subscribe-493"><a href="#subscribe-493"><span class="linenos">493</span></a>                        <span class="p">),</span>
</span><span id="subscribe-494"><a href="#subscribe-494"><span class="linenos">494</span></a>                    <span class="p">),</span>
</span><span id="subscribe-495"><a href="#subscribe-495"><span class="linenos">495</span></a>                <span class="p">)</span>
</span><span id="subscribe-496"><a href="#subscribe-496"><span class="linenos">496</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_producers</span><span class="p">):</span>
</span><span id="subscribe-497"><a href="#subscribe-497"><span class="linenos">497</span></a>                <span class="n">q</span><span class="p">:</span> <span class="n">MessageQueue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span>
</span><span id="subscribe-498"><a href="#subscribe-498"><span class="linenos">498</span></a>                    <span class="n">maxsize</span><span class="o">=</span><span class="n">max_messages_per_producer</span><span class="p">,</span>
</span><span id="subscribe-499"><a href="#subscribe-499"><span class="linenos">499</span></a>                <span class="p">)</span>
</span><span id="subscribe-500"><a href="#subscribe-500"><span class="linenos">500</span></a>                <span class="n">consumer_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="subscribe-501"><a href="#subscribe-501"><span class="linenos">501</span></a>                    <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span>
</span><span id="subscribe-502"><a href="#subscribe-502"><span class="linenos">502</span></a>                        <span class="n">consumer</span><span class="p">(</span>
</span><span id="subscribe-503"><a href="#subscribe-503"><span class="linenos">503</span></a>                            <span class="n">q</span><span class="p">,</span>
</span><span id="subscribe-504"><a href="#subscribe-504"><span class="linenos">504</span></a>                            <span class="n">handler</span><span class="p">,</span>
</span><span id="subscribe-505"><a href="#subscribe-505"><span class="linenos">505</span></a>                            <span class="n">ack_queue</span><span class="p">,</span>
</span><span id="subscribe-506"><a href="#subscribe-506"><span class="linenos">506</span></a>                            <span class="n">ack_deadline_cache</span><span class="p">,</span>
</span><span id="subscribe-507"><a href="#subscribe-507"><span class="linenos">507</span></a>                            <span class="n">num_tasks_per_consumer</span><span class="p">,</span>
</span><span id="subscribe-508"><a href="#subscribe-508"><span class="linenos">508</span></a>                            <span class="n">nack_queue</span><span class="p">,</span>
</span><span id="subscribe-509"><a href="#subscribe-509"><span class="linenos">509</span></a>                            <span class="n">metrics_client</span><span class="o">=</span><span class="n">metrics_client</span><span class="p">,</span>
</span><span id="subscribe-510"><a href="#subscribe-510"><span class="linenos">510</span></a>                        <span class="p">),</span>
</span><span id="subscribe-511"><a href="#subscribe-511"><span class="linenos">511</span></a>                    <span class="p">),</span>
</span><span id="subscribe-512"><a href="#subscribe-512"><span class="linenos">512</span></a>                <span class="p">)</span>
</span><span id="subscribe-513"><a href="#subscribe-513"><span class="linenos">513</span></a>                <span class="n">producer_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="subscribe-514"><a href="#subscribe-514"><span class="linenos">514</span></a>                    <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span>
</span><span id="subscribe-515"><a href="#subscribe-515"><span class="linenos">515</span></a>                        <span class="n">producer</span><span class="p">(</span>
</span><span id="subscribe-516"><a href="#subscribe-516"><span class="linenos">516</span></a>                            <span class="n">subscription</span><span class="p">,</span>
</span><span id="subscribe-517"><a href="#subscribe-517"><span class="linenos">517</span></a>                            <span class="n">q</span><span class="p">,</span>
</span><span id="subscribe-518"><a href="#subscribe-518"><span class="linenos">518</span></a>                            <span class="n">subscriber_client</span><span class="p">,</span>
</span><span id="subscribe-519"><a href="#subscribe-519"><span class="linenos">519</span></a>                            <span class="n">max_messages</span><span class="o">=</span><span class="n">max_messages_per_producer</span><span class="p">,</span>
</span><span id="subscribe-520"><a href="#subscribe-520"><span class="linenos">520</span></a>                            <span class="n">metrics_client</span><span class="o">=</span><span class="n">metrics_client</span><span class="p">,</span>
</span><span id="subscribe-521"><a href="#subscribe-521"><span class="linenos">521</span></a>                        <span class="p">),</span>
</span><span id="subscribe-522"><a href="#subscribe-522"><span class="linenos">522</span></a>                    <span class="p">),</span>
</span><span id="subscribe-523"><a href="#subscribe-523"><span class="linenos">523</span></a>                <span class="p">)</span>
</span><span id="subscribe-524"><a href="#subscribe-524"><span class="linenos">524</span></a>
</span><span id="subscribe-525"><a href="#subscribe-525"><span class="linenos">525</span></a>            <span class="c1"># TODO: since this is in a `not BUILD_GCLOUD_REST` section, we</span>
</span><span id="subscribe-526"><a href="#subscribe-526"><span class="linenos">526</span></a>            <span class="c1"># shouldn&#39;t have to care about py2 support. Using splat syntax</span>
</span><span id="subscribe-527"><a href="#subscribe-527"><span class="linenos">527</span></a>            <span class="c1"># here, though, breaks the coverage.py reporter for this file even</span>
</span><span id="subscribe-528"><a href="#subscribe-528"><span class="linenos">528</span></a>            <span class="c1"># though it would never be loaded at runtime in py2.</span>
</span><span id="subscribe-529"><a href="#subscribe-529"><span class="linenos">529</span></a>            <span class="c1"># all_tasks = [*producer_tasks, *consumer_tasks, *acker_tasks]</span>
</span><span id="subscribe-530"><a href="#subscribe-530"><span class="linenos">530</span></a>            <span class="n">all_tasks</span> <span class="o">=</span> <span class="n">producer_tasks</span> <span class="o">+</span> <span class="n">consumer_tasks</span> <span class="o">+</span> <span class="n">acker_tasks</span>
</span><span id="subscribe-531"><a href="#subscribe-531"><span class="linenos">531</span></a>            <span class="n">done</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
</span><span id="subscribe-532"><a href="#subscribe-532"><span class="linenos">532</span></a>                <span class="n">all_tasks</span><span class="p">,</span>
</span><span id="subscribe-533"><a href="#subscribe-533"><span class="linenos">533</span></a>                <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span><span class="p">,</span>
</span><span id="subscribe-534"><a href="#subscribe-534"><span class="linenos">534</span></a>            <span class="p">)</span>
</span><span id="subscribe-535"><a href="#subscribe-535"><span class="linenos">535</span></a>            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
</span><span id="subscribe-536"><a href="#subscribe-536"><span class="linenos">536</span></a>                <span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="subscribe-537"><a href="#subscribe-537"><span class="linenos">537</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;a subscriber worker shut down unexpectedly&#39;</span><span class="p">)</span>
</span><span id="subscribe-538"><a href="#subscribe-538"><span class="linenos">538</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="subscribe-539"><a href="#subscribe-539"><span class="linenos">539</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;subscriber exited&#39;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
</span><span id="subscribe-540"><a href="#subscribe-540"><span class="linenos">540</span></a>            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">producer_tasks</span><span class="p">:</span>
</span><span id="subscribe-541"><a href="#subscribe-541"><span class="linenos">541</span></a>                <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</span><span id="subscribe-542"><a href="#subscribe-542"><span class="linenos">542</span></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
</span><span id="subscribe-543"><a href="#subscribe-543"><span class="linenos">543</span></a>                <span class="n">producer_tasks</span><span class="p">,</span>
</span><span id="subscribe-544"><a href="#subscribe-544"><span class="linenos">544</span></a>                <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">ALL_COMPLETED</span><span class="p">,</span>
</span><span id="subscribe-545"><a href="#subscribe-545"><span class="linenos">545</span></a>            <span class="p">)</span>
</span><span id="subscribe-546"><a href="#subscribe-546"><span class="linenos">546</span></a>
</span><span id="subscribe-547"><a href="#subscribe-547"><span class="linenos">547</span></a>            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">consumer_tasks</span><span class="p">:</span>
</span><span id="subscribe-548"><a href="#subscribe-548"><span class="linenos">548</span></a>                <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</span><span id="subscribe-549"><a href="#subscribe-549"><span class="linenos">549</span></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
</span><span id="subscribe-550"><a href="#subscribe-550"><span class="linenos">550</span></a>                <span class="n">consumer_tasks</span><span class="p">,</span>
</span><span id="subscribe-551"><a href="#subscribe-551"><span class="linenos">551</span></a>                <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">ALL_COMPLETED</span><span class="p">,</span>
</span><span id="subscribe-552"><a href="#subscribe-552"><span class="linenos">552</span></a>            <span class="p">)</span>
</span><span id="subscribe-553"><a href="#subscribe-553"><span class="linenos">553</span></a>
</span><span id="subscribe-554"><a href="#subscribe-554"><span class="linenos">554</span></a>            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">acker_tasks</span><span class="p">:</span>
</span><span id="subscribe-555"><a href="#subscribe-555"><span class="linenos">555</span></a>                <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</span><span id="subscribe-556"><a href="#subscribe-556"><span class="linenos">556</span></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">acker_tasks</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">ALL_COMPLETED</span><span class="p">)</span>
</span><span id="subscribe-557"><a href="#subscribe-557"><span class="linenos">557</span></a>
</span><span id="subscribe-558"><a href="#subscribe-558"><span class="linenos">558</span></a>        <span class="k">raise</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">(</span><span class="s1">&#39;subscriber shut down&#39;</span><span class="p">)</span>
</span></pre></div>


    

                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>